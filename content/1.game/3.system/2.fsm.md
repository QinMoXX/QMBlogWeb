---
title: æœ‰é™çŠ¶æ€æœº
description: æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰çš„åŸºæœ¬æ¦‚å¿µã€å®šä¹‰ä»¥åŠå¦‚ä½•åœ¨æ¸¸æˆå¼€å‘ä¸­åº”ç”¨çŠ¶æ€æ¨¡å¼æ¥æ„å»ºçµæ´»ä¸”å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿã€‚
icon: lucide:book-type

navTruncate: false

authors:
  - name: QinMo
    avatar: /avatar-32.jpg
    to: /
    target: _blank
---

<!-- Content of the page -->

# ä»€ä¹ˆæ˜¯çŠ¶æ€æœº
æœ‰é™çŠ¶æ€æœºè¿™ä¸ªç§°å‘¼å¬èµ·æ¥å°±åƒå­˜åœ¨ä¸€ä¸ªâ€œäº²å…„å¼Ÿâ€â€”â€”æ— é™çŠ¶æ€æœºï¼Œæ‰€ä»¥å®ƒä»¬åº”å½“æœ‰ä¸ªå…±åŒçš„â€œçˆ¶äº²â€â€”â€”çŠ¶æ€æœºã€‚

å®šä¹‰ä¸ŠçŠ¶æ€æœºæ˜¯ä¸€ç§æŠ½è±¡çš„è®¡ç®—æ¨¡å‹ï¼Œç”¨äºè®¾è®¡å…·æœ‰**ç¦»æ•£çŠ¶æ€**çš„ç³»ç»Ÿã€‚çŠ¶æ€æœºé€šè¿‡çŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„**è½¬æ¢è§„åˆ™**æ¥æè¿°ç³»ç»Ÿçš„è¡Œä¸ºã€‚

ç¦»æ•£çŠ¶æ€è¯´æ˜æ¨¡å‹ä¸­å­˜åœ¨èƒ½å¤Ÿå¯æ•°çš„åŒºåˆ†å½¢æ€æ ‡è¯†ï¼Œä»£ç ä¸­é€šå¸¸ä½¿ç”¨å­—æ®µæ ‡è¯†æ‰€å¤„çŠ¶æ€ï¼Œä¾‹å¦‚è§’è‰²çš„è¿åŠ¨æ¨¡å‹å­˜åœ¨ "idle, running, walking..."ç­‰ç­‰çš„åŠ¨ç”»çŠ¶æ€ï¼Œä¸åŒçš„çŠ¶æ€ä¸‹è§’è‰²æ‰§è¡Œä¸åŒçš„æ¨¡å‹åŠ¨ç”»ã€‚idle çŠ¶æ€ä¸‹çš„è§’è‰²æ ¹æ®ç©å®¶çš„å‰è¿›æ“ä½œè½¬å˜åˆ° walking çŠ¶æ€å¹¶æ‰§è¡Œè¡Œèµ°åŠ¨ç”»ï¼Œè¿™ä¾¿æ˜¯çŠ¶æ€ç›´æ¥çš„è½¬æ¢è¿‡ç¨‹ã€‚æ­¤è¿‡ç¨‹åˆ‡æ¢ä¸­ç©å®¶æ˜¯å¦æŒ‰ä¸‹â€œå‰è¿›é”®â€çš„æ¡ä»¶åˆ¤æ–­ä¾¿æ˜¯çŠ¶æ€åˆ‡æ¢è¿‡ç¨‹ä¸­çš„è½¬æ¢è§„åˆ™ã€‚

æ ¹æ®è¿™æ ·çš„æ–¹å¼æˆ‘ä»¬ä½¿ç”¨å¤§é‡æ¡ä»¶åˆ¤æ–­æ¥å¤„ç†ä¸åŒçš„çŠ¶æ€è½¬æ¢ï¼Œå‡ºç°ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç 
```csharp
class Person
{
	public string state;

	public void Update()
	{
		if (Input.GetKeyDown(KeyCode.W))
		{
			state = "Walking";
		}//....
	}
	public void Execut()
	{
		if (state == "Idel")
		{
			// ç©ºé—²çŠ¶æ€é€»è¾‘
		}else if (state == "Walking")
		{
			// è¡Œèµ°çŠ¶æ€é€»è¾‘
		}else if (state == "Running")
		{
			//è·‘æ­¥çŠ¶æ€é€»è¾‘
		}
	}
}
```
ä¸€æ—¦æˆ‘ä»¬å¼€å§‹å‘è¯¥ç±»æ·»åŠ è¶Šæ¥è¶Šå¤šçš„çŠ¶æ€å’ŒçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºï¼Œæ·»åŠ ä¾‹å¦‚â€œæŒ‰ä¸‹ç©ºæ ¼ï¼Œç©å®¶è·³è·ƒï¼Œæ¡çº¦åä¸èƒ½ç«‹å³å¥”è·‘ï¼Œè·³è·ƒæ—¶ä¸èƒ½æ”»å‡»â€ï¼Œä½ å‘ç°**åŸºäºæ¡ä»¶åˆ¤æ–­çš„çŠ¶æ€æœº**æœ€å¤§å¼±ç‚¹å°±å‡¸æ˜¾å‡ºæ¥äº†ã€‚å¯¹çš„ï¼Œä½ æ²¡çœ‹é”™è¿™å°±æ˜¯æœ€ç®€æ˜“çš„çŠ¶æ€æœºï¼Œä¸ºäº†ä¸æ˜“æ··æ·†æˆ‘ä»¬å°†å…¶å«åš**æ¡ä»¶çŠ¶æ€æœº**ï¼Œæ›´ç²¾ç¡®ç‚¹å«åš**æ¡ä»¶æœ‰é™çŠ¶æ€æœº**ï¼ˆğŸ˜æœ¬äººç®€åŒ–å«æ³•ï¼Œæˆ–è®¸æ ¹æœ¬æœç´¢ä¸åˆ°ğŸ˜ï¼‰ã€‚å¤§é‡çš„æ–‡ç« å°†è¿™ç§ä»£ç åˆ’åˆ†åˆ°çŠ¶æ€æœºçš„å¯¹ç«‹é¢ï¼Œä½†ä»”ç»†è§‚å¯Ÿå®ƒå®Œå…¨ç¬¦åˆçŠ¶æ€æœºçš„å®šä¹‰ï¼Œè€Œå¸‚é¢ä¸Šé‚£ç§ç”¨äºè§£å†³é¡½ç–¾çš„ä»£ç æ•‘æ˜Ÿï¼Œå®é™…ä¸Šæ˜¯æˆ‘ä»¬ä¸‹é¢è¦è®²çš„åŸºäºçŠ¶æ€æ¨¡å¼çš„çŠ¶æ€æœºã€‚

# çŠ¶æ€æ¨¡å¼
é¦–å…ˆæˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸€ä¸ªå¸¸è§çš„è®¾è®¡æ¨¡å¼â€”â€”çŠ¶æ€æ¨¡å¼ï¼ˆState Patternsï¼‰ï¼Œè™½ç„¶å®ƒä»¬å¹¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ¦‚å¿µä¸Šå¯†åˆ‡ç›¸å…³ã€‚

> çŠ¶æ€æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå…è®¸å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚çœ‹èµ·æ¥å¥½åƒå¯¹è±¡æ”¹å˜äº†å®ƒçš„ç±»ã€‚

çŠ¶æ€æ¨¡å¼å»ºè®®æ‚¨ä¸ºå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€åˆ›å»ºæ–°ç±»ï¼Œå¹¶å°†æ‰€æœ‰ç‰¹å®šäºçŠ¶æ€çš„è¡Œä¸ºæå–åˆ°è¿™äº›ç±»ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´çŠ¶æ€å°†æ˜¯ä¸€ä¸ªç±»ï¼ŒçŠ¶æ€æœºå­˜å‚¨è¿™äº›çŠ¶æ€å¯¹è±¡å¼•ç”¨ï¼ŒåŸå§‹çš„æ‰§è¡Œé€»è¾‘ä¸åœ¨çŠ¶æ€æœºä¸­æ‰§è¡Œï¼Œæ‰§è¡Œé€»è¾‘ä»£ç ä¹Ÿäº¤ç”±çŠ¶æ€ç±»ç®¡ç†ã€‚

> è¦å°†ä¸Šä¸‹æ–‡è½¬æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼Œè¯·å°†æ´»åŠ¨çŠ¶æ€å¯¹è±¡æ›¿æ¢ä¸ºè¡¨ç¤ºè¯¥æ–°çŠ¶æ€çš„å¦ä¸€ä¸ªå¯¹è±¡ã€‚ä»…å½“æ‰€æœ‰çŠ¶æ€ç±»éƒ½éµå¾ªç›¸åŒçš„æ¥å£å¹¶ä¸”ä¸Šä¸‹æ–‡æœ¬èº«é€šè¿‡è¯¥æ¥å£ä¸è¿™äº›å¯¹è±¡ä¸€èµ·å·¥ä½œæ—¶ï¼Œè¿™æ‰æ˜¯å¯èƒ½çš„ã€‚

å®šä¹‰çŠ¶æ€éœ€è¦å®ç°çš„æ¥å£ï¼ŒåŒ…å«è¿›å…¥çŠ¶æ€ã€é€€å‡ºçŠ¶æ€å’Œæ›´æ–°çŠ¶æ€çš„æ–¹æ³•ã€‚State æ¥å£å£°æ˜ç‰¹å®šäºçŠ¶æ€çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•åº”è¯¥å¯¹æ‰€æœ‰å…·ä½“çŠ¶æ€éƒ½æœ‰æ„ä¹‰ã€‚
```csharp
public interface IFsmState  
{  
    void OnInt();  
    void OnEnter();  
    void OnUpdate();  
    void OnLeave();  
    void ChangeState();  
}
```
çŠ¶æ€æœºç†è§£ä¸ºçŠ¶æ€ç®¡ç†ç±»ï¼Œç®¡ç†æœ‰é™çš„çŠ¶æ€é›†åˆã€‚å†…éƒ¨æ„å»ºç¨‹åºå¾ªç¯æ—¶çš„çŠ¶æ€æ›´æ–° `Update`ï¼Œä»¥åŠä¾›çŠ¶æ€ç±»ä½¿ç”¨çš„çŠ¶æ€å˜æ›´æ–¹æ³•ã€‚æ²¡æœ‰æŠ½è±¡çš„ `Fsm` ç±»æ„å‘³ç€çŠ¶æ€çš„æ”¹å˜è§„åˆ™é€»è¾‘ä¸åœ¨ç®¡ç†å™¨å†…éƒ¨ï¼Œè€Œæ˜¯äº¤ç”±çŠ¶æ€ç±» `OnUpdate` å®ç°ã€‚è™½ç„¶å®ç° `Fsm` ç¼–å†™äº†ä¸å°‘ä»£ç ï¼Œä½†ä»é•¿è¿œè§’åº¦çœ‹çŠ¶æ€åˆ‡æ¢é€»è¾‘å˜å¾—ç²¾ç®€ï¼Œå‡å°‘çš„æ‚ç³…çš„é€»è¾‘ä»£ç æœ‰åŠ©äºé¡¹ç›®çš„ç»´æŠ¤ã€‚
```csharp
public class Fsm
{
	private IFsmState[] fsmStates; //æœ‰é™çŠ¶æ€é›†åˆ
	private IFsmState currentState; //å½“å‰æ‰§è¡ŒçŠ¶æ€

	public Fsm()
	{
		fsmStates = Array.Empty<IFsmState>();
	}
	
	public Fsm(params IFsmState[] states)
	{
		fsmStates = states;
	}

	public void AddOrCreateState(IFsmState state)
	{
		if (state == null)
		{
			throw new Exception("new status unknown");
		}
		IFsmState[] newStats = new IFsmState[this.fsmStates.Length + 1];
		Array.Copy(this.fsmStates,newStats,this.fsmStates.Length);
		newStats[newStats.Length] = state;
		state.OnInt();
		this.fsmStates = newStats;
	}
	
	public bool IsRunning
	{
		get => this.currentState != null;
	}

	public IFsmState CurrentState
	{
		get => this.currentState;
	}

	public void Update()
	{
		if (this.CurrentState == null && this.fsmStates is { Length: > 0 })
		{
			this.currentState = this.fsmStates[0];
			this.currentState?.OnEnter();
		}

		this.currentState?.OnUpdate();
	}

	public void ChangeState<T>() where T : class, IFsmState
	{
		this.currentState?.OnLeave();
		foreach (var fsmState in this.fsmStates)
		{
			if (fsmState.GetType() == typeof(T))
			{
				this.currentState = fsmState;
				this.currentState?.OnEnter();
			}
		}

		if (this.currentState == null)
		{
			this.Close();
		}
	}

	public void Close()
	{
		this.currentState = null;
		this.fsmStates = Array.Empty<IFsmState>();
	}
}
```

æ˜¯çš„ï¼Œå°†ä¹‹å‰è§’è‰²åŠ¨ç”»çš„æ¡ˆä¾‹ç”¨ç°åœ¨çš„**çŠ¶æ€æ¨¡å¼çŠ¶æ€æœº**å®ç°å°†ä¼šå˜å¾—ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬å¿½ç•¥äº†ä¸Šä¸‹æ–‡å…³ç³»ï¼Œæ— æ³•è®©æ‰€æœ‰çŠ¶æ€çŸ¥æ™“å¤–ç•Œä¿¡æ¯ã€‚æ‰€ä»¥ä¸€ä¸ªæ›´åŠ å®Œå–„çš„æ¥å£åº”è¯¥ä¸ºçŠ¶æ€èµ‹äºˆè®¾ç½®ä¸Šä¸‹æ–‡çš„æ–¹æ³•ã€‚
```csharp
public interface IFsmState  
{  
    void OnInt();  
    void OnEnter();  
    void OnUpdate();  
    void OnLeave();  
    void ChangeState();  
    void SetContext<T>(T context);
}
```
è¿™é‡Œçš„ä¸Šä¸‹æ–‡å†…å®¹æ˜¯æŠ½è±¡çš„è¡¨ç¤ºï¼Œä¸ç¡®å®šç”¨æˆ·ç±»å‹ï¼Œå¸¸è§çš„æ–¹å¼æ˜¯ä¼ é€’çŠ¶æ€ç®¡ç†å™¨ `FsmHandle`ï¼Œå¹¶é€šè¿‡æ›¿æ¢é“¾æ¥åˆ°ä¸Šä¸‹æ–‡çš„çŠ¶æ€å¯¹è±¡æ¥æ‰§è¡Œå®é™…çš„çŠ¶æ€è½¬æ¢ã€‚

# è¿›é˜¶
æ–‡æœ¬ä¸»è°ˆæ¸¸æˆå¼€å‘ä¸­çš„çŠ¶æ€æœºåº”ç”¨ã€‚çŠ¶æ€æœºå› å…¶å…·å¤‡çš„ä¼˜åŠ¿åœ¨å¼€å‘ä¸­åº”ç”¨å¹¿æ³›ã€‚ä¾‹å¦‚è¡Œä¸ºæ§åˆ¶ã€æµç¨‹æ§åˆ¶ã€å¯¹è±¡ç®¡ç†ç­‰ã€‚æ‰€ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æ™®éä¼šå’Œå¤šä¸ªä¸åŒåº”ç”¨äºä¸åŒæ¨¡å—çš„çŠ¶æ€æœºæ‰“äº¤é“ï¼Œä¸ºæ­¤æˆ‘ä»¬å¸Œæœ›æ„é€ æŠ½è±¡ä¸”å®Œå¤‡çš„çŠ¶æ€æœºåŸºç±»ä»¥ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚çµæ´»æ€§å’Œå¯æ‰©å±•æ€§å¿…ä¸å¯å°‘ã€‚

â“å¥½å§ï¼Œæˆ‘ä»¬æ˜ç¡®äº†ä¸€ä¸ªå¤§èƒ†ç›®æ ‡ï¼Œä½†è¯¥å¦‚ä½•ç€æ‰‹å®Œæˆè¿™é¡¹å·¥ä½œå‘¢ï¼Ÿæˆ–è€…è®¾è®¡æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ

## é¢å‘æ¥å£è®¾è®¡
æ—¢ç„¶çŠ¶æ€æœºè¦è¢«å¤šæ•°æ¨¡å—ä½¿ç”¨ï¼Œæ¨¡å—ä¹‹é—´éµå®ˆç‹¬ç«‹åŸåˆ™ï¼Œé‚£ä¹ˆå„è‡ªæ‰€å±çš„çŠ¶æ€æœºä¹‹é—´ä¹Ÿåº”å½“æ˜¯ç‹¬ç«‹çš„ã€‚åŸºäºçŠ¶æ€æœºæ„å»ºçš„åŠŸèƒ½æ¨¡å—åªç»´æŠ¤**ç‹¬ç«‹**ä¸”**ç‰¹å®š**çš„çŠ¶æ€æœºå¯¹è±¡ã€‚æ˜¾è€Œæ˜“è§çš„é¦–è¦å·¥ä½œæ˜¯å°†çŠ¶æ€æœºçš„å®šä¹‰å’Œå®ç°ä¸å…·ä½“çš„æ¸¸æˆæ¨¡å—è§£è€¦, ä½¿çŠ¶æ€æœºæˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¯å¤ç”¨ç»„ä»¶ã€‚ç‰¹å®šæ„å‘³ç€çŠ¶æ€æœºç±»å‹å…·å¤‡å¯æ‰©å±•æ€§ã€‚æ‰€ä»¥çŠ¶æ€æœºçš„å®šä¹‰åº”è¯¥å°½å¯èƒ½é€šç”¨å’ŒæŠ½è±¡,ä¸åº”è¯¥ä¸ç‰¹å®šçš„æ¸¸æˆæ¨¡å—è€¦åˆã€‚
äºæ˜¯,è®©æˆ‘ä»¬å°† `Fsm` é‡å†™ä¸º `FsmBase` æŠ½è±¡åŸºç±»,å°†å¤–éƒ¨ä½¿ç”¨çš„é€šç”¨åŠŸèƒ½å½’äº `IFsm` ä¹‹ä¸‹ã€‚å°±å½“åšæ˜¯å°†è¿™çŠ¶æ€æœºæ‰“é€ æˆæ™ºæ…§ä¹‹æ ‘,æ ¹æ·±å¶èŒ‚,ä¸‡ç‰©çš†å¯æ‰˜å…¶è«è€Œå­˜ã€‚

å®Œå–„åçš„çŠ¶æ€æ¥å£å®šä¹‰ä¸ºå¦‚ä¸‹
```csharp
public interface IFsmState
{
	public void OnInit();
	public void OnEnter(IFsm content);
	public void OnUpdate(float elapseSeconds, float realElapseSeconds);
	public void OnLeave();
	public void OnDestroy();
	public void ChangeState<TState>() where TState:IFsmState;
	public void ChangeState(Type stateType);
}
```
å…¶ä¸­åŒ…å«å…¨æ–°çš„ç”Ÿå­˜å‘¨æœŸå‡½æ•°ï¼ŒçŠ¶æ€è¿›å…¥æ—¶ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œä»¥åŠæ›´å¥½æ›´å¤šçš„çŠ¶æ€æ”¹å˜æ–¹æ³•å®šä¹‰ã€‚ä½†è¿™æ ·çš„æ–¹å¼è¿èƒŒäº†**å°è£…åŸåˆ™**ï¼Œç°åœ¨è¿™äº›æ–¹æ³•å˜å¾—å…¨å±€å¯è§ï¼Œç”šè‡³å¯ä¾›å…¬å¼€è°ƒç”¨ã€‚çŠ¶æ€ç±»çš„æ–¹æ³•è°ƒç”¨åªä¼šå­˜åœ¨äºå…¶è¿è¡Œå‘¨æœŸï¼Œåº”å½“åˆç†ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦éšè—å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚æ‰€ä»¥ `IFsmState` è¢«é—å¼ƒï¼Œè½¬è€Œå–ä»£å®ƒçš„æ˜¯ `FsmStateBase`ã€‚
```csharp
public abstract class FsmStateBase
{
	protected IFsm m_fsmHandle;
	protected internal FsmStateBase(IFsm handle)
	{
		this.m_fsmHandle = handle;
	}

	protected abstract void OnInit();

	protected internal abstract void OnEnter();

	protected internal abstract void OnUpdate(float elapseSeconds, float realElapseSeconds);

	protected internal abstract void OnLeave();

	protected internal virtual void OnDestroy()
	{
		this.m_fsmHandle = null;
	}

	protected void ChangeState<TState>() where TState : FsmStateBase
	{
		if (this.m_fsmHandle == null)
		{
			throw new Exception("Fsm is invalid");
		}
		this.m_fsmHandle.ChangeState<TState>();
	}

	protected void ChangeState(Type stateType)
	{
		if (this.m_fsmHandle == null)
		{
			throw new Exception("Fsm is invalid");
		}
		this.m_fsmHandle.ChangeState(stateType);
	}
}
```
`protected internal` ä¿®é¥°ç¬¦æ„å‘³ç€:è¢«ä¿®é¥°çš„æˆå‘˜å¯ä»¥åœ¨å½“å‰ç±»ã€å­ç±»,ä»¥åŠåŒä¸€ç¨‹åºé›†å†…çš„ä»»ä½•å…¶ä»–ç±»å‹ä¸­è®¿é—®ã€‚ä½†æ˜¯åœ¨ç¨‹åºé›†ä¹‹å¤–çš„ä»£ç ä¸­,è¯¥æˆå‘˜æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚ç»“åˆæˆ‘ä»¬å½“å‰æƒ…å†µï¼Œå…¶ä½œç”¨ä¿è¯ç¨‹åºé›†å†…éƒ¨ `FsmBase` å’Œç¨‹åºé›†å¤–éƒ¨ `FsmStateBase` çš„æ´¾ç”Ÿç±»è®¿é—®ã€‚

`Fsm` å†…çš„å…¬å…±æ–¹æ³•ä»ç”± ` IFsm ` æ¥å£å£°æ˜ï¼Œæ¥å£å®šä¹‰äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æœ‰é™çŠ¶æ€æœº,åŒ…æ‹¬çŠ¶æ€æœºçš„å¯åŠ¨ã€åœæ­¢ã€çŠ¶æ€åˆ‡æ¢ã€çŠ¶æ€è·å–ç­‰æ ¸å¿ƒåŠŸèƒ½,åŒæ—¶ä¹Ÿè€ƒè™‘äº†çŠ¶æ€æœºæ›´æ–°å’Œå…³é—­çš„éœ€æ±‚ã€‚
- **çŠ¶æ€æœºåŸºæœ¬ä¿¡æ¯**:æä¾›äº†è·å–çŠ¶æ€æœºåç§°ã€çŠ¶æ€æ•°é‡ã€è¿è¡ŒçŠ¶æ€çš„å±æ€§,ç”¨äºè·å–çŠ¶æ€æœºçš„åŸºæœ¬ä¿¡æ¯ã€‚
- **çŠ¶æ€æœºå¯åŠ¨å’Œåœæ­¢**:å®šä¹‰äº†`Start`å’Œ`Stop`æ–¹æ³•,ç”¨äºå¯åŠ¨å’Œåœæ­¢çŠ¶æ€æœºçš„è¿è¡Œã€‚
- **çŠ¶æ€æ£€æŸ¥å’Œè·å–**:æä¾›äº†`HasState`å’Œ`GetState`æ–¹æ³•,ç”¨äºæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªçŠ¶æ€,ä»¥åŠè·å–æŒ‡å®šçŠ¶æ€çš„å®ä¾‹ã€‚è¿˜æœ‰ä¸€ä¸ª`GetAllStates`æ–¹æ³•å¯ä»¥è·å–çŠ¶æ€æœºä¸­æ‰€æœ‰çŠ¶æ€ã€‚
- **çŠ¶æ€åˆ‡æ¢**:å®šä¹‰äº†`ChangeState`æ–¹æ³•,ç”¨äºåœ¨çŠ¶æ€æœºè¿è¡Œæ—¶åˆ‡æ¢åˆ°æŒ‡å®šçš„æ–°çŠ¶æ€ã€‚
- **çŠ¶æ€æœºæ›´æ–°**:æœ‰ä¸€ä¸ª`Update`æ–¹æ³•,ç”¨äºåœ¨æ¯ä¸ªé€»è¾‘å‘¨æœŸæ›´æ–°çŠ¶æ€æœºçš„æ‰§è¡Œ,ä¼ å…¥é€»è¾‘æ—¶é—´å’ŒçœŸå®æ—¶é—´å‚æ•°ã€‚
- **çŠ¶æ€æœºå…³é—­**:æä¾›äº†`Shutdown`æ–¹æ³•,ç”¨äºå…³é—­å’Œæ¸…ç†çŠ¶æ€æœºã€‚
- **çŠ¶æ€ç±»å‹çº¦æŸ**:è®¸å¤šæ–¹æ³•ä½¿ç”¨äº†æ³›å‹ç±»å‹å‚æ•°`TState`,å®ƒè¢«çº¦æŸä¸ºå¿…é¡»æ´¾ç”Ÿè‡ª`FsmStateBase`ç±»,è¿™å¯èƒ½æ˜¯çŠ¶æ€çš„åŸºç±»ã€‚
- **å†…éƒ¨æ–¹æ³•**:æœ‰å‡ ä¸ªè¢«æ ‡è®°ä¸º`internal`çš„æ–¹æ³•,å¯èƒ½æ˜¯ä¾›çŠ¶æ€æœºå†…éƒ¨ä½¿ç”¨,è€Œä¸æ˜¯å¯¹å¤–å…¬å¼€çš„æ¥å£ã€‚
```csharp
public interface IFsm  
{  
  public string Name { get; }  
  public int Count { get; }  
  public bool IsRunning { get; }  
  public FsmStateBase CurrentState { get; }  
  public void Start<TState>() where TState : FsmStateBase;  
  public void Start(Type stateType);  
  public void Stop();  
  public bool HasState<TState>() where TState : FsmStateBase;  
  public FsmStateBase GetState<TState>() where TState : FsmStateBase;  
  public FsmStateBase GetState(Type stateType);  
  public FsmStateBase[] GetAllStates();  
  internal void Update(float elapseSeconds, float realElapseSeconds);  
  internal void Shutdown();  
  internal void ChangeState<TState>() where TState : FsmStateBase;  
  internal void ChangeState(Type stateType);  
}
```
æŠŠæ¥å£å½“ä½œä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ä¿±ä¹éƒ¨ï¼Œå®ƒä¸ºä¼šå‘˜æä¾›äº†ä¸€ç³»åˆ—ä¼˜è´¨çš„çŠ¶æ€æœºæœåŠ¡ã€‚é¦–å…ˆ,å®ƒå…è®¸ä¼šå‘˜è·å–ä¿±ä¹éƒ¨çš„åŸºæœ¬ä¿¡æ¯,æ¯”å¦‚åç§°ã€ä¼šå‘˜äººæ•°ä»¥åŠæ˜¯å¦æ­£åœ¨è¥ä¸šä¸­ã€‚åŒæ—¶ä½œä¸ºä¸€ä¸ªå°Šé‡éšç§çš„é«˜ç«¯ä¿±ä¹éƒ¨ï¼Œå®ƒåªä¸ºå†…éƒ¨äººå‘˜æä¾›äº†ä¸€äº›ç‰¹æ®ŠæœåŠ¡ï¼Œæ¯”å¦‚æ›´æ–°ä¿±ä¹éƒ¨è¿è¡ŒçŠ¶æ€ã€å…³é—­æ•´ä¸ªä¿±ä¹éƒ¨ä»¥åŠæ›´æ¢å½“å‰æœåŠ¡ç”Ÿã€‚å®ƒç”¨éå¸¸ä¼˜é›…çš„æ–¹å¼è®¾è®¡è´¯å½»äº†"ä¼šå‘˜ç¬¬ä¸€ã€æœåŠ¡è‡³ä¸Š"çš„ç†å¿µï¼Œé€šè¿‡è§„èŒƒçš„æ¥å£çº¦å®šï¼Œä¸ºä¼šå‘˜æä¾›äº†ä¸€æµçš„çŠ¶æ€æœºä½“éªŒã€‚

ç°åœ¨æˆ‘ä»¬ä¸ºè¯¥æ¥å£æ·»åŠ åŸºç¡€å®ç°ã€‚å†…éƒ¨å­˜å‚¨çŠ¶æ€ç±»å‹å’ŒçŠ¶æ€çš„æ˜ å°„å…³ç³»ï¼ŒçŠ¶æ€åˆ‡æ¢æ—¶éå¸¸å®¹æ˜“çš„æ‰¾åˆ°å®ƒä»¬ã€‚æ¥å£ `internal void` å£°æ˜çš„"å†…éƒ¨äººå‘˜æœåŠ¡"ï¼Œåœ¨å®ç°æ—¶æœ‰ç‚¹ç‰¹åˆ«
`void IFsm.ChangeState(Type stateType)` â€”â€”æŒ‡å®šäº†æ¥å£ï¼Œå¹¶ä¸”ä¸èƒ½å¤Ÿåœ¨è¢«ç»§æ‰¿ã€‚å°±åƒä¸€ä¸ªé¡¶çº§çš„æ€æ‰‹ä¿±ä¹éƒ¨ï¼Œèº«ä»½ç»‘å®šæœ¬äººä¸å¯è½¬å€Ÿï¼Œç”šè‡³ä¸å¯å‘ŠçŸ¥ä»–äººã€‚
```csharp
public abstract class FsmBase:IFsm
{
  private readonly Dictionary<Type, FsmStateBase> m_States;
  private FsmStateBase m_CurrentState;
  
  private string m_Name;
  public string Name
  {
	get
	{
	  return m_Name;
	}
	protected set
	{
	  m_Name = value ?? string.Empty;
	}
  }
  
  
  public int Count => m_States.Count;
  public bool IsRunning => m_CurrentState != null;
  public FsmStateBase CurrentState => m_CurrentState;

  public FsmBase()
  {
	m_States = new Dictionary<Type, FsmStateBase>();
	m_CurrentState = null;
  }
  
  
  public void Start<TState>() where TState : FsmStateBase
  {
	if (IsRunning)
	{
	  throw new Exception("Fsm is Running, can not start again.");
	}

	FsmStateBase state = GetState<TState>();
	if (state == null)
	{
	  throw new Exception($"Fsm {m_Name} can not start state '{typeof(TState).FullName} which is not exist");
	}

	m_CurrentState = state;
	m_CurrentState.OnEnter();
  }

  public void Start(Type stateType)
  {
	if (IsRunning)
	{
	  throw new Exception("Fsm is Running, can not start again.");
	}

	FsmStateBase state = GetState(stateType);
	if (state == null)
	{
	  throw new Exception($"Fsm {m_Name} can not start state '{stateType.FullName} which is not exist");
	}

	m_CurrentState = state;
	m_CurrentState.OnEnter();
  }

  public void Stop()
  {
	m_CurrentState.OnLeave();
	m_CurrentState = null;
  }

  public bool HasState<TState>() where TState : FsmStateBase
  {
	return HasState(typeof(TState));
  }

  public bool HasState(Type stateType)
  {
	if (m_States.Count == 0)
	{
	  return false;
	}

	if (!m_States.ContainsKey(stateType))
	{
	  return false;
	}
	return true;
  }

  public FsmStateBase GetState<TState>() where TState : FsmStateBase
  {
	return GetState(typeof(TState));
  }

  public FsmStateBase GetState(Type stateType)
  {
	if (m_States.TryGetValue(stateType, out FsmStateBase state))
	{
	  return state;
	}
	return null;
  }

  public FsmStateBase[] GetAllStates()
  {
	return m_States.Values.ToArray();
  }

  void IFsm.Update(float elapseSeconds, float realElapseSeconds)
  {
	if (m_CurrentState == null)
	{
	  return;
	}
	m_CurrentState.OnUpdate(elapseSeconds, realElapseSeconds);
  }

  void IFsm.Shutdown()
  {
	Stop();
	//TODO:å›æ”¶çŠ¶æ€æœº
  }

  void IFsm.ChangeState<TState>()
  {
	(this as IFsm).ChangeState(typeof(TState));
  }

  void IFsm.ChangeState(Type stateType)
  {
	if (m_CurrentState == null)
	{
	  throw new Exception("Current state is invalid.");
	}

	FsmStateBase state = null;
	if (!m_States.TryGetValue(stateType, out state))
	{
	  throw new Exception($"Fsm '{m_Name} can not change state to '{stateType.FullName}' which is not exist");
	}
	
	m_CurrentState.OnLeave();
	m_CurrentState = state;
	m_CurrentState.OnEnter();
  }
}
```
ä»¥ä¸Šçš„çš„ä»£ç å®Œæˆäº†ä¸€ä¸ªçŠ¶æ€æœºå¯åŠ¨ã€è¿è¡Œå’Œç»“æŸçš„å¿…è¦ç¼–ç ï¼Œæ¯ä¸ªçŠ¶æ€è¿è¡Œæ—¶çš„ç”Ÿå­˜å‘¨æœŸå‡½æ•°åŒæ ·ä¿è¯è¢«æ­£ç¡®è°ƒç”¨... ç¨ç­‰, æˆ‘ä»¬å¯èƒ½å¿½ç•¥æ‰äº†ä¸€ä¸ªå‡½æ•° `OnInit` ï¼Œè¿™æ˜¯è¿è¡Œå‰çš„åˆå§‹çŠ¶æ€åˆå§‹åŒ–ï¼Œè¿™éå¸¸é‡è¦ã€‚å½“ä½ ååœ¨å§å°å³å°†ç‚¹ä¸Šé‚£æ¯è®©ä½ é­‚ç‰µæ¢¦ç»•çš„è«å‰æ‰˜ï¼Œå´å‘ç°é’±åŒ…æ ¹æœ¬æ²¡å¸¦ï¼Œé…’ä¿ä¼¼ä¹çœ‹å‡ºäº†ä½ çš„çª˜è¿«ï¼Œä½†ä»–æ­¤åˆ»æ‰“é‡çš„çœ¼ç¥è®©ä½ çŸ¥é“èµŠè´¦ææ€•æ²¡é—¨ã€‚ä½ å¯ä¸æƒ³è¿™æ ·çš„äº‹æƒ…åœ¨çŠ¶æ€æœºä¸­åå¤å‘ç”ŸæŠŠï¼Ÿä¸ `OnEnter` ç›¸æ¯”å®ƒæ˜¯åœ¨çŠ¶æ€ç±»åˆ›å»ºçš„é¦–æ¬¡è°ƒç”¨ğŸ’µã€‚é‚£æˆ‘ä»¬ä½•æ—¶å»åšè¿™ä»¶äº‹æƒ…ï¼Œå½“ç„¶æ˜¯â€œè®¡åˆ’å¥½ä»Šæ™šçš„æ´»åŠ¨åï¼Œå‡ºé—¨å‰çš„å‡†å¤‡å·¥ä½œâ€ã€‚è¿™æ®µæè¿°å½“ä¸­ä¸€ä¸¤ä¸ªå…³é”®ç‚¹"æ´»åŠ¨è®¡åˆ’"å’Œâ€œå‡†å¤‡å·¥ä½œâ€ã€‚

åœ¨ `FsmBase` å†…éƒ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä½¿ç”¨å…¸å‹çš„å·¥ç¨‹æ¨¡å¼å°†çŠ¶æ€å’ŒçŠ¶æ€åˆå§‹åŒ–å®Œæˆï¼Œè¿”å›å‡†å¤‡å¥½çš„çŠ¶æ€æœºå¯¹è±¡ã€‚å¥½ä¼¼ä¸€ä¸ªä¼˜ç§€çš„ç§˜ä¹¦ï¼Œåªç”¨å‘Šè¯‰å¥¹ä»Šå¤©çš„å®‰æ’ï¼Œå‡ºé—¨çš„æ—¶å€™æ–‡ä»¶å’Œå¸æœºä¾¿ä»¥å‡†å¤‡å¦¥å½“ï¼Œå‰©ä¸‹çš„å‡ºå‘å°±å¥½äº†ã€‚
```csharp
public static FsmBase Create<T>(string name, params Type[] stateTypes) where T:FsmBase
{
	if (stateTypes == null || stateTypes.Length<1)
	{
	  throw new Exception("Fsm states is invalid");
	}

	FsmBase fsm = Activator.CreateInstance<T>();
	fsm.Name = name;
	foreach (var stateType in stateTypes)
	{
	  if (stateType == null)
	  {
		throw new Exception("FSM states is invalid.");
	  }

	  if (!typeof(FsmStateBase).IsAssignableFrom(stateType))
	  {
		throw new Exception("Fsm state type is invalid.");
	  }

	  if (fsm.m_States.ContainsKey(stateType))
	  {
		throw new Exception($"Fsm '{name}' state '{stateType.FullName}' is already exist.");
	  }

	  FsmStateBase state = Activator.CreateInstance(stateType, fsm) as FsmStateBase;
	  fsm.m_States.Add(stateType, state);
	  state.OnInit();
	}

	return fsm;
}
```

## æ¨¡å—åŒ–ç»Ÿä¸€ç®¡ç†
å‰é¢å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨é¢å‘æ¥å£çš„æ–¹å¼è®¾è®¡çŠ¶æ€æœºã€‚è¿˜æœ‰ä¸€ç‚¹å€¼å¾—ä»”ç»†æ€è€ƒâ€”â€”å¤šä¸ªçŠ¶æ€æœºå¦‚ä½•å…±ç”Ÿã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä»å¦‚ä½•ç®¡ç†çŠ¶æ€çš„æ€ç»´å±‚æ¬¡æé«˜åˆ°äº†å¦‚ä½•ç®¡ç†çŠ¶æ€æœºâš™ï¸ã€‚æ‰€ä»¥è¿™é‡Œè¦åšçš„æ˜¯å¯¹çŠ¶æ€æœºçš„ç»Ÿä¸€ç®¡ç†ã€‚æˆ‘ä»¬é€æ¸å‘ä¸Šæ”¶ç¼©çš„å±‚çº§ç»“æ„æ¨¡ä»¿äº†ä¼ä¸šçš„å±‚çº§ç®¡ç†æ¨¡å¼ï¼Œç§°ä½œçŠ¶æ€æœºçš„â€œå°ç»„é•¿â€ç®¡ç†ç€ä¸€æ‰¹çŠ¶æ€â€œå‘˜å·¥â€ï¼ŒçŠ¶æ€æœºâ€œéƒ¨é—¨ç»ç†â€æŒ‡å¯¼ç€æ‰€æœ‰â€œå°ç»„é•¿â€ã€‚å½“ç„¶è¿˜å¯ä»¥åœ¨å‘ä¸Šå‘æ˜ï¼Œä¸åŒçš„â€œéƒ¨é—¨ç»ç†â€ç”±â€œCEOâ€ç»Ÿä¸€è°ƒåº¦ï¼Œåªä¸è¿‡è¿™ä¸æ˜¯æœ¬æ–‡çš„è¦ç‚¹ï¼Œåœ¨è¿™ä¸åšå™è¿°ã€‚
```csharp
public sealed partial class FsmManager
{

	private readonly Dictionary<string, FsmBase> m_Fsms;
	private readonly List<FsmBase> m_FsmsCache;

	public FsmManager()
	{
		m_Fsms = new Dictionary<string, FsmBase>();
		m_FsmsCache = new List<FsmBase>();
	}

	public int Count
	{
		get => m_Fsms.Count;
	}

	public void Update(float elapseSeconds, float realElapseSeconds)
	{
		
		foreach (var fsm in m_FsmsCache)
		{
			if (!fsm.IsRunning)
			{
				continue;
			}
			(fsm as IFsm).Update(elapseSeconds,realElapseSeconds);
		}
	}

	public void Shutdown()
	{
		foreach (var kp in m_Fsms)
		{
			(kp.Value as IFsm).Shutdown();
		}
		
		m_Fsms.Clear();
		m_FsmsCache.Clear();
	}

	public bool HasFsm(string name)
	{
		if (string.IsNullOrEmpty(name))
		{
			throw new Exception("Fsm name is invalid.");
		}
		
		return m_Fsms.ContainsKey(name);
	}
	

	/// <summary>
	/// è·å–æ‰€æœ‰çŠ¶æ€æœºæ•°ç»„
	/// </summary>
	/// <returns></returns>
	public FsmBase[] GetAllFsms()
	{
		return m_FsmsCache.ToArray();
	}

	public IFsm CreateFsm<T>(string name, params Type[] states) where T : FsmBase
	{
		if (string.IsNullOrEmpty(name))
		{
			throw new Exception("Fsm name is invalid.");
		}
		
		if (m_Fsms.ContainsKey(name))
		{
			throw new Exception($"Fsm '{name}' already exists.");
		}

		FsmBase fsm = FsmBase.Create<T>(name, states);
		m_Fsms.Add(name, fsm);
		m_FsmsCache.Add(fsm);
		return fsm;
	}

	public bool RemoveFsm(string name)
	{
		if (string.IsNullOrEmpty(name))
		{
			throw new Exception("Fsm name is invalid.");
		}

		FsmBase fsm = null;
		if (!m_Fsms.TryGetValue(name,out fsm))
		{
			return true;
		}

		(fsm as IFsm).Shutdown();
		m_Fsms.Remove(name);
		m_FsmsCache.Remove(fsm);
		return true;
	}
}
```
æˆ‘ä»¬ä»ä»¥ä¸‹å‡ ç‚¹åˆ†æï¼Œä»¥ä¸Šä»£ç æ˜¯å¦‚ä½•è¾¾åˆ°ç›®çš„
1. é›†ä¸­ç®¡ç†: ä½¿ç”¨ `Dictionary` å­˜å‚¨æ‰€æœ‰å·²åˆ›å»ºçš„çŠ¶æ€æœº, ä»¥çŠ¶æ€æœºåç§°ä½œä¸ºé”®, ç¡®ä¿äº†çŠ¶æ€æœºåç§°çš„å”¯ä¸€æ€§ã€‚åŒæ—¶, å®ƒè¿˜ä½¿ç”¨ä¸€ä¸ª `List` ä½œä¸ºç¼“å­˜, ç”¨äºå­˜å‚¨å½“å‰å¤„äºè¿è¡ŒçŠ¶æ€çš„çŠ¶æ€æœºå®ä¾‹, ä»¥ä¾¿è¿›è¡Œé«˜æ•ˆçš„çŠ¶æ€æ›´æ–°ã€‚
2. ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼š`CreateFsm` æ–¹æ³•ç”¨äºåˆ›å»ºæ–°çš„çŠ¶æ€æœºå®ä¾‹, å¹¶åœ¨å†…éƒ¨è¿›è¡Œå¿…è¦çš„æœ‰æ•ˆæ€§æ£€æŸ¥, é˜²æ­¢é‡å¤åˆ›å»ºã€‚åœ¨çŠ¶æ€æœºè¿è¡ŒæœŸé—´, å®ƒé€šè¿‡ `Update` æ–¹æ³•å®šæœŸæ›´æ–°è¿è¡Œä¸­çš„çŠ¶æ€æœºã€‚å½“çŠ¶æ€æœºä¸å†éœ€è¦æ—¶, å¯ä»¥è°ƒç”¨ `RemoveFsm` æ–¹æ³•å°†å…¶ä»ç®¡ç†å™¨ä¸­ç§»é™¤å¹¶è¿›è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚
3. å°è£…å’Œå®‰å…¨æ€§ï¼šå¯¹å¤–éƒ¨ä»£ç éšè—äº†çŠ¶æ€æœºç®¡ç†çš„å†…éƒ¨ç»†èŠ‚, åªæä¾›äº†æœ‰é™çš„å…¬å…±æ¥å£ã€‚è¿™äº›æ¥å£éƒ½åŒ…å«äº†å¿…è¦çš„å‚æ•°éªŒè¯å’Œå¼‚å¸¸å¤„ç†, ç¡®ä¿äº†ç®¡ç†å™¨çš„å¥å£®æ€§å’Œå®‰å…¨æ€§ã€‚åŒæ—¶, é€šè¿‡å°† `FsmManager` è®¾è®¡ä¸ºå¯†å°ç±», é˜²æ­¢äº†å¤–éƒ¨ä»£ç å¯¹å…¶è¿›è¡Œç»§æ‰¿å’Œä¿®æ”¹, ä»è€Œä¿è¯äº†ç®¡ç†å™¨çš„å°è£…æ€§å’Œä¸€è‡´æ€§ã€‚

# æ€»ç»“
æœ¬æ–‡å‚è€ƒGameFrameworkæ¡†æ¶çš„çŠ¶æ€æœºå®ç°,æç‚¼å¹¶ç²¾ç®€äº†ç›¸å…³ä»£ç ,å‘æ‚¨å‘ˆç°äº†ä¸€ä¸ªä¼˜ç§€çš„çŠ¶æ€æœºç¤ºä¾‹,å±•ç°äº†ä½œè€…å¯¹è¯¥æ¡†æ¶çŠ¶æ€æœºä»£ç çš„æ·±å…¥ç†è§£å’Œç²¾å¿ƒæ„å»ºã€‚åœ¨æ­¤,æˆ‘è°¨å‘æ¡†æ¶ä½œè€…è¡¨è¾¾ç”±è¡·çš„æ•¬æ„ã€‚ç„¶è€Œ,å°½ç®¡æ‚¨å¯¹æœ¬æ–‡å†…å®¹æŒè‚¯å®šæ€åº¦,ä½†è¿˜è¯·ç•™æ„ä»¥ä¸‹å‡ ç‚¹:
- ä»£ç å³æ€æƒ³
å½“å‰æ‰€ç¼–å†™ä»£ç å¹¶éä¸ç¯å¢ƒåŒ¹é…ï¼Œä¾‹å¦‚å¤šç¨‹åºé›†çš„è®¾è®¡ä»éœ€è¦å¼€å‘è€…é’ˆå¯¹è®¾è®¡ï¼Œæ–‡ç« ä¸­å¹¶æœªæ¸…æ™°æŒ‡å‡ºä»£ç æ–‡ä»¶å­˜æ”¾ç»“æ„ã€‚æ–‡ä¸­æ‰€ç”¨ç¼–è¯‘ç¯å¢ƒä¸º NetFramework 4.7.1ï¼Œ csharp 9.0 çš„è¯­æ³•è§„åˆ™å¹¶éå—åˆ°æ‰€æœ‰ç¯å¢ƒæ”¯æŒï¼Œå¹¶ä¸”ä»£ç ä¸­æ•…æ„ä¿ç•™äº†å°‘è®¸ç»†å¾®é”™è¯¯ã€‚ä½¿ç”¨æ—¶è¯·åŠ¡å¿…æ…é‡ã€‚
- çº¿ç¨‹å®‰å…¨
æœ¬æ–‡è¾ƒå¤šçš„è°ˆè®ºçŠ¶æ€æœºåœ¨æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯ï¼Œå› æ­¤å…¶å®ç°æ²¡æœ‰è€ƒè™‘å¤šçº¿ç¨‹è®¿é—®çš„æƒ…å†µã€‚å¦‚æœåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶æ‰§è¡Œ,å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´çš„çŠ¶æ€ã€‚ä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨,éœ€è¦åœ¨å…³é”®åŒºåŸŸä½¿ç”¨åŒæ­¥æœºåˆ¶,å¦‚é”æˆ–å…¶ä»–çº¿ç¨‹åŒæ­¥åŸè¯­ã€‚
- ç¼“å­˜ç®¡ç†
æ¨¡å—ç¼“å­˜å®ç°ä½¿ç”¨ `List` å®ç°ï¼Œå¦‚æœçŠ¶æ€æœºæ•°é‡å¾ˆå¤§,è¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ•°æ®ç»“æ„æ¥ä¼˜åŒ–ç¼“å­˜ç®¡ç†,ä¾‹å¦‚ä½¿ç”¨`HashSet`æˆ–è€…è‡ªå®šä¹‰çš„ç¼“å­˜ç®¡ç†å™¨,ä»¥æé«˜è®¿é—®æ•ˆç‡ã€‚
- çŠ¶æ€æœºå¤ç”¨
å½“å‰çš„å®ç°åœ¨æ¯æ¬¡ `CreateFsm` æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€æœºå®ä¾‹,ä½†æ²¡æœ‰æä¾›é‡ç”¨å·²åˆ›å»ºå®ä¾‹çš„æœºåˆ¶ã€‚å¦‚æœéœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ç›¸åŒç±»å‹çš„çŠ¶æ€æœºå®ä¾‹,å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½å¼€é”€ã€‚å¯ä»¥è€ƒè™‘å®ç°ä¸€ä¸ªå¯¹è±¡æ± æœºåˆ¶,ä»¥å…è®¸çŠ¶æ€æœºå®ä¾‹åœ¨éœ€è¦æ—¶è¢«é‡ç”¨,ä»è€Œæé«˜èµ„æºåˆ©ç”¨ç‡å’Œæ€§èƒ½ã€‚ï¼ˆGameFramework æ¡†æ¶åŒ…å«ä¼˜ç§€çš„å¤ç”¨æœºåˆ¶ï¼‰
å¦‚æœ‰ç–æ¼æˆ–ä¸å½“ä¹‹å¤„,è¿˜è¯·ä¸åèµæ•™ã€‚
# å‚è€ƒ
> Jiang, Ellan. â€œEllanJiang/GameFramework.â€ _GitHub_, 14 June 2024, github. Com/EllanJiang/GameFramework/. Accessed 14 June 2024.

> [State (refactoring.guru)](https://refactoring.guru/design-patterns/state) ã€Šæ·±å…¥è®¾è®¡æ¨¡å¼ã€‹