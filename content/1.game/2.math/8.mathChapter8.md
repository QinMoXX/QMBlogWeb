---
title: ç¬¬å…«ç« 
description: åœ¨ä¸‰ç»´ä¸­è¡¨ç¤ºæ–¹å‘å’Œè§’ä½ç§»çš„ä¸åŒæŠ€æœ¯ï¼šæ¬§æ‹‰è§’ã€æ—‹è½¬çŸ©é˜µã€æŒ‡æ•°æ˜ å°„å’Œå››å…ƒæ•°ã€‚
icon: lucide:book-type

navTruncate: false

authors:
  - name: QinMo
    avatar: /avatar-32.jpg
    to: /
    target: _blank
---

<!-- Content of the page -->
# ä¸‰ç»´æ—‹è½¬ 
åœ¨æ•°å­¦ä¸­â€œorientationâ€å’Œâ€œdirectionâ€ä¸¤è¯å®šä¹‰ä¸Šå­˜åœ¨åŒºåˆ«ï¼Œåè€…ä»£è¡¨çš„æ˜¯ç‰©ä½“æŒ‡å‘çš„æœå‘ï¼Œç‰©ä½“åœ¨ä¸‰ç»´ç©ºé—´ä¸­ç§»åŠ¨æˆ–æŒ‡å‘çš„å…·ä½“æ–¹å‘ã€‚å‰è€…ä»£è¡¨çš„æ˜¯ç‰©ä½“è‡ªèº«çš„æ—‹è½¬çŠ¶æ€ã€‚æœ‰æ—¶æˆ‘ä»¬ä½¿ç”¨"å®šå‘"å’Œ"æ–¹å‘"åœ¨ä¸­æ–‡è¯­ä¹‰é‡ŒåŒºåˆ†ä¸¤è¯çš„ç»†å¾®å·®åˆ«ã€‚

# çŸ©é˜µå½¢å¼
æè¿° 3D åæ ‡ç©ºé—´æ–¹å‘çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ¤æ–­è¯¥åæ ‡ç©ºé—´çš„åŸºå‘é‡ï¼Œå¦æ— è®ºåæ ‡ç©ºé—´å¤„äºä»€ä¹ˆæ–¹å‘ã€‚æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å…¶ä»–åæ ‡ç©ºé—´æ¥æè¿°åŸºå‘é‡ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸¤ä¸ªåæ ‡ç©ºé—´çš„ç›¸å¯¹æ–¹å‘ã€‚ä½¿ç”¨è¿™äº›åŸºå‘é‡å½¢æˆçš„ 3X 3 çŸ©é˜µçš„è¡Œï¼Œå°±ä»¥çŸ©é˜µå½¢å¼è¡¨è¾¾äº†**å®šå‘**ã€‚
åŒæ—¶ä»–æ˜¯ä¸€ä¸ªæ—‹è½¬çŸ©é˜µï¼šæˆ‘ä»¬å¯ä»¥å°†è¡Œå‘é‡ä¹˜ä»¥è¯¥çŸ©é˜µï¼Œå°†è¿™äº›å‘é‡ä»å¯¹è±¡ç©ºé—´åæ ‡è½¬æ¢ä¸ºç›´ç«‹ç©ºé—´åæ ‡ã€‚

## æ–¹å‘ä½™å¼¦çŸ©é˜µ Direction Cosines Matrix
éå¸¸å¤è€çš„ï¼‰æœ¯è¯­â€œæ–¹å‘ä½™å¼¦â€ã€‚æ–¹å‘ä½™å¼¦çŸ©é˜µä¸æ—‹è½¬çŸ©é˜µç›¸åŒï¼›è¯¥æœ¯è¯­åªæ˜¯æŒ‡è§£é‡Šï¼ˆæˆ–æ„é€ ï¼‰çŸ©é˜µçš„ç‰¹æ®Šæ–¹å¼ã€‚ä»”ç»†è§‚å¯Ÿä¼šå‘ç°æ—‹è½¬çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ ç­‰äºä¸€ä¸ªç©ºé—´ä¸­çš„åŸºè½´ä¸å¦ä¸€ç©ºé—´ä¸­çš„åŸºè½´çš„ç‚¹ç§¯ï¼Œç„¶è€Œä¸¤ä¸ªå•ä½å‘é‡çš„ç‚¹ç§¯æ­£å¥½ç­‰äºå®ƒä»¬ä¹‹é—´è§’åº¦çš„ä½™å¼¦ã€‚

## çŸ©é˜µå½¢å¼ä¼˜åŠ£åŠ¿

ä¼˜åŠ¿ ï¼šæ—‹è½¬å‘é‡æ˜“äºè®¡ç®—ï¼ŒçŸ©é˜µæ˜¯å›¾å½¢ API ä½¿ç”¨çš„æ ¼å¼ï¼Œå¤šä¸ªè½¬æ¢å¯ä»¥è¿æ¥æˆä¸€ä¸ªçŸ©é˜µï¼Œåå‘è®¡ç®—æ—‹è½¬åªéœ€è¦ä½¿ç”¨é€†çŸ©é˜µåšä¹˜æ³•

åŠ£åŠ¿ï¼šæ›´å¤šçš„å†…å­˜å ç”¨ï¼Œä¸åˆ©äºç›´æ¥é˜…è¯»ï¼Œå¹¶éä»»æ„å€¼éƒ½å¯ä»¥å½¢æˆæœ‰æ•ˆçš„çŸ©é˜µï¼Œè¯¯å·®å®¹æ˜“æ”¾å¤§é”™è¯¯ç»“æœ

# æ¬§æ‹‰è§’ Euler Angles

> è¯¥æŠ€æœ¯ä»¥å¼€å‘è¯¥æŠ€æœ¯çš„è‘—åæ•°å­¦å®¶ Leonhard Eulerï¼ˆ1707-1783ï¼‰å‘½åã€‚

æ¬§æ‹‰è§’èƒŒåçš„åŸºæœ¬æ€æƒ³æ˜¯å°†è§’ä½ç§»å®šä¹‰ä¸ºå›´ç»•ä¸‰ä¸ªç›¸äº’å‚ç›´çš„è½´çš„ä¸‰ä¸ªæ—‹è½¬çš„åºåˆ—ã€‚
å…³äºæè¿°äº’ç›¸å‚ç›´çš„ä¸‰ä¸ªæ—‹è½¬è½´æ¦‚å¿µå®šä¹‰ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¸¸è§çš„æœ‰èˆªç©ºèˆªå¤©é¢†åŸŸæµè¡Œçš„**åèˆª-ä¿¯ä»°-æ¨ªæ»š**ï¼ˆyaw-pitch-rollï¼‰ã€‚è¿™ä¸ç¬¬ä¸ƒç« ä¸­æˆ‘ä»¬å®šä¹‰**çƒåæ ‡**ä¸­ä½¿ç”¨çš„**èˆªå‘-ä¿¯ä»°-ç»„**ï¼ˆheading-pitch-bankï¼‰æ˜¯ç›¸åŒçš„ç³»ç»Ÿã€‚
ä¸æ­¢æ˜¯åç§°å®šä¹‰ä¸Šä¸åŒï¼Œæœ‰æ—¶å‡ºç°å®ƒä»¬çš„å‡ºç°é¡ºåºä¼šä¸åŒï¼Œæ¯”å¦‚**æ¨ªæ»š-ä¿¯ä»°-åèˆª**ã€‚

**å®šè½´ç³»ç»Ÿ**ä¸**æ¬§æ‹‰è§’ç³»ç»Ÿ**å…³ç³»éå¸¸å¯†åˆ‡ã€‚åœ¨**æ¬§æ‹‰è§’ç³»ç»Ÿ**ä¸­ï¼Œæ—‹è½¬å›´ç»•ä¸»ä½“è½´å‘ç”Ÿï¼Œæ¯æ¬¡æ—‹è½¬åä¸»ä½“è½´éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨**å®šè½´ç³»ç»Ÿ**ä¸­ï¼Œæ—‹è½¬è½´å§‹ç»ˆç›¸åŒâ€”â€”ç›´ç«‹è½´ã€‚åªè¦æ—‹è½¬é¡ºåºç›¸åï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿæ˜¯ç­‰æ•ˆçš„ã€‚
åœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œå½“å°†çŸ¢é‡ä»ç›´ç«‹ç©ºé—´æ—‹è½¬åˆ°ç‰©ä½“ç©ºé—´æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šä½¿ç”¨çš„æ˜¯å®šè½´ç³»ç»Ÿã€‚
å›ºå®šè½´çº¦å®šä¹Ÿç§°ä¸º**å¤–åœ¨çº¦å®š**ï¼ˆextrinsicï¼‰ï¼Œå…¸å‹çš„æ¬§æ‹‰è§’çº¦å®šç§°ä¸º**å†…åœ¨çº¦å®š**ï¼ˆintrinsicï¼‰ã€‚

## æ¬§æ‹‰è§’å½¢å¼ä¼˜åŠ£åŠ¿

ä¼˜åŠ¿ï¼šè¡¨è¾¾ç›´è§‚ï¼Œå®¹æ˜“ä½¿ç”¨ï¼Œå†…å­˜å ç”¨ä½ï¼Œä»»æ„ç»„åˆéƒ½æœ‰æ•ˆ

åŠ£åŠ¿ï¼šç»™å®šæ–¹å‘çš„è¡¨ç¤ºä¸æ˜¯å”¯ä¸€çš„ï¼Œåœ¨ä¸¤ä¸ªæ¬§æ‹‰è§’ä¹‹é—´è¿›è¡Œæ’å€¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸‡å‘èŠ‚é”

ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œç”±äºä¸‡å‘èŠ‚é”ï¼ŒæŸäº›æ–¹å‘æ— æ³•ä½¿ç”¨æ¬§æ‹‰è§’æ¥æè¿°ã€‚å®é™…ä¸Šï¼Œ3D ç©ºé—´ä¸­çš„ä»»æ„ä¸€ä¸ªè§’åº¦éƒ½å¯ä»¥ç”¨æ¬§æ‹‰è§’è¡¨ç¤ºã€‚

è§„èŒƒæ¬§æ‹‰è§’èƒ½å¤Ÿè§£å†³ä¸€éƒ¨åˆ†è§’åº¦é‡å é€ æˆæ’å€¼é—®é¢˜ï¼Œä½†æ˜¯è§’åº¦çš„å¾ªç¯æ€§è´¨ä»ç„¶ä¼šé€ ç ´åã€‚è¿™ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†æ’å€¼æ–¹ç¨‹ä¸­ä½¿ç”¨çš„è§’åº¦ä¹‹é—´çš„æ’å€¼åŒ…å«åœ¨ $(-180^\circ , +180^\circ]$ èŒƒå›´å†…ï¼Œä»¥ä¾¿æ‰¾åˆ°æœ€çŸ­çš„è·¯å¾„ã€‚ä¸ºæ­¤æˆ‘ä»¬å¼•å…¥ç¬¦å·ï¼š
$$
\operatorname{wrapP}_{1}(x)=x-360^{\circ}\left \lfloor\left(x+180^{\circ}\right) / 360^{\circ}\right\rfloor
$$
å…¶ä¸­ $\left \lfloor . \right \rfloor$ è¡¨ç¤ºä¸‹å–æ•´å‡½æ•°ã€‚

# è½´è§’ Axis-Angle å’ŒæŒ‡æ•°æ˜ å°„ Exponential Map
æ¬§æ‹‰æ—‹è½¬å®šä¹‰åŸºæœ¬è¡¨æ˜ä»»ä½• 3D è§’ä½ç§»éƒ½å¯ä»¥é€šè¿‡ç»•ç²¾å¿ƒé€‰æ‹©çš„è½´è¿›è¡Œå•æ¬¡æ—‹è½¬æ¥å®ç°ã€‚è¡¨ç¤ºä¸ºå°†ç‰©ä½“æŒ‰æ—‹è½¬è§’åº¦Â Â $\theta$ å’Œç©¿è¿‡åŸç‚¹å¹¶å¹³è¡Œäºå•ä½å‘é‡Â Â $\hat n$ çš„æ—‹è½¬è½´ã€‚
è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªå€¼ $\theta$ å’Œ $\hat n$ï¼Œç”±äº $\hat n$ å…·æœ‰å•ä½é•¿åº¦ï¼Œå…¶å¯ä»¥ä¹˜ä»¥ $\theta$ è€Œä¸ä¸¢å¤±ä¿¡æ¯ï¼Œä»è€Œäº§ç”Ÿå•ä¸ªå‘é‡ $e = \theta \hat n$ã€‚æ¢å¥è¯è¯´ï¼Œ$\theta = \left \Vert e \right \Vert$ï¼Œæ—‹è½¬è½´é€šè¿‡å½’ä¸€åŒ– $e$ è·å¾—ã€‚

 $\theta$ å’Œ $\hat n$ å°±æ˜¯ä»¥**è½´è§’**çš„æ–¹å¼è¡¨ç¤ºè§’ä½ç§»ï¼Œ$e$ ä»£è¡¨çš„æ˜¯**æŒ‡æ•°æ˜ å°„**æ–¹å¼ã€‚

æŒ‡æ•°æ˜ å°„å’Œæ¬§æ‹‰è§’ç›¸æ¯”åŒæ ·å­˜åœ¨å¥‡ç‚¹ï¼Œä½†å®ƒçš„æ’å€¼ç‰¹æ€§æ¯”æ¬§æ‹‰è§’æ›´å¥½ï¼Œå¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚åŠ¨ç”»æ•°æ®çš„å­˜å‚¨ï¼Œæœªè¢«å……åˆ†é‡è§†çš„æŒ‡æ•°å›¾å¯èƒ½æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆã€‚

ä½†æŒ‡æ•°æ˜ å°„æœ€é‡è¦å’Œæœ€é¢‘ç¹çš„ä½¿ç”¨ä¸æ˜¯å­˜å‚¨è§’ä½ç§»ï¼Œè€Œæ˜¯å­˜å‚¨è§’é€Ÿåº¦ã€‚è¿™æ˜¯å› ä¸ºæŒ‡æ•°å›¾åŒºåˆ†å¾—å¾ˆå¥½ï¼ˆè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šä¸å…¶æ›´å¥½çš„æ’å€¼å±æ€§æœ‰å…³ï¼‰å¹¶ä¸”å¯ä»¥è½»æ¾è¡¨ç¤ºå¤šä¸ªæ—‹è½¬ã€‚
äºæ¬§æ‹‰è§’ä¸€æ ·ï¼Œæ·»åŠ  360 åº¦çš„å€æ•°ä¼šäº§ç”Ÿè§’ä½ç§»ï¼Œä»è€Œå¯¼è‡´ç›¸åŒçš„ç»“æŸæ–¹å‘ï¼Œå‡ºç°**æ··å **ã€‚ä½†è¿™å¹¶ä¸å®Œå…¨æ˜¯ä¸€ä¸ªåäº‹ï¼ŒæŒ‡æ•°æ˜ å°„æè¿°è§’é€Ÿåº¦çš„æ–¹å¼ï¼Œè¿™ç§è¡¨ç¤ºè¿™ç§â€œé¢å¤–â€æ—‹è½¬çš„èƒ½åŠ›æ˜¯ä¸€ä¸ªé‡è¦ä¸”æœ‰ç”¨çš„å±æ€§ã€‚

> F.Â Sebastin Grassia. Â  â€œPractical Parameterization of Rotations Using the Exponential Map.â€ Â Â _J. Graph. Tools_Â 3 (1998), 29â€“48. Â Â [http://jgt.akpeters.com/papers/Grassia98/](http://jgt.akpeters.com/papers/Grassia98/).

---

# å››å…ƒæ•° Quaternions
å››å…ƒæ•°é€šè¿‡ä½¿ç”¨å››ä¸ªæ•°å­—æ¥è¡¨ç¤ºæ–¹å‘ï¼ˆå› æ­¤ç§°ä¸ºå››å…ƒæ•°ï¼‰æ¥é¿å…æ¬§æ‹‰è§’é—®é¢˜ã€‚
## è¡¨ç¤ºæ–¹æ³•
å››å…ƒæ•°åŒ…å«æ ‡é‡åˆ†é‡å’Œ 3D å‘é‡åˆ†é‡ã€‚æˆ‘ä»¬é€šå¸¸å°†æ ‡é‡ç»„ä»¶ç§°ä¸ºÂ Â ğ‘¤ã€‚æˆ‘ä»¬å¯ä»¥å°†å‘é‡åˆ†é‡ç§°ä¸ºå•ä¸ªå®ä½“Â Â $\mathbf{v}$ æˆ–å•ç‹¬çš„åˆ†é‡Â Â ğ‘¥ã€Â Â ğ‘¦å’ŒÂ Â ğ‘§ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸¤ç§è¡¨ç¤ºæ³•çš„ç¤ºä¾‹ï¼š
$$
[w, \mathbf{v}] , \ [w \ (x \ y \ z)].
$$
$$
\left[\begin{array}{l}
w \\
\begin{pmatrix}
x \\
y \\
z
\end{pmatrix}
\end{array}\right] .
$$
## è¡¨ç¤ºå«ä¹‰
**å››å…ƒæ•°**å½¢å¼ä¸**è½´è§’**å’Œ**æŒ‡æ•°æ˜ å°„**å½¢å¼å¯†åˆ‡ç›¸å…³ã€‚å››å…ƒæ•°è¿˜åŒ…å«è½´å’Œè§’åº¦ï¼Œä½†æ˜¯Â Â $\hat n$ å’ŒÂ $\theta$ å¹¶ä¸æ˜¯ç®€å•åœ°ç›´æ¥å­˜å‚¨åœ¨å››å…ƒæ•°çš„å››ä¸ªæ•°å­—ä¸­ï¼Œå› ä¸ºå®ƒä»¬æ˜¯è½´è§’åº¦ã€‚
$$
\begin{aligned}
{[w \quad \mathbf{v}] } & =\left[\cos (\theta / 2) \quad \sin (\theta / 2) \hat{\mathbf{n}}\right], \\
{[w \quad(x \quad y \quad z)] } & =\left[\cos (\theta / 2) \quad(\sin (\theta / 2) n_{x} \quad \sin (\theta / 2) n_{y} \quad \sin (\theta / 2) n_{z})\right] .
\end{aligned}
$$
Â Â $w$ ä¸Â Â $\theta$ ç›¸å…³ï¼Œä½†å®ƒä»¬ä¸æ˜¯åŒä¸€ä»¶äº‹ã€‚åŒæ ·ï¼ŒÂ Â $\mathbf{v}$ å’ŒÂ Â $\hat n$ ç›¸å…³ï¼Œä½†ä¸ç›¸åŒã€‚
## å››å…ƒæ•°å¦å®š Quaternion Negation
å››å…ƒæ•°å¯ä»¥å–å  
$$
\begin{aligned}
\mathbf{-q} & =-[w \quad(x \quad y \quad z)]=-[-w \quad(-x \quad-y \quad-z)] \\
& =-[w \quad \mathbf{v}]=[-w \quad-\mathbf{v}] .
\end{aligned}
$$
å››å…ƒæ•°Â Â $\mathbf{q}$ å’ŒÂ Â $\mathbf{-q}$ æè¿°ç›¸åŒçš„è§’ä½ç§»ã€‚ 3D ä¸­çš„ä»»ä½•è§’ä½ç§»åœ¨å››å…ƒæ•°æ ¼å¼ä¸­éƒ½æœ‰ä¸¤ç§ä¸åŒçš„è¡¨ç¤ºå½¢å¼ï¼Œå¹¶ä¸”å®ƒä»¬äº’ä¸ºè´Ÿæ•°ã€‚å¦‚æœæˆ‘ä»¬å°†Â Â 360 åº¦æ·»åŠ åˆ°Â Â $\theta$ï¼Œå®ƒä¸ä¼šæ”¹å˜Â Â $\mathbf{q}$ è¡¨ç¤ºçš„è§’ä½ç§»ï¼Œä½†å®ƒä¼šå¦å®šÂ Â $\mathbf{q}$ çš„æ‰€æœ‰å››ä¸ªåˆ†é‡ã€‚

## æ’ç­‰å››å…ƒæ•° Identity Quaternion
åœ¨å‡ ä½•ä¸Šï¼Œæœ‰ä¸¤ä¸ªâ€œåŒä¸€â€å››å…ƒæ•°ä»£è¡¨â€œæ— è§’ä½ç§»â€ã€‚å®ƒä»¬æ˜¯
$$
[1 \ 0] \ and \ [-1 \ 0]
$$
## å››å…ƒæ•°å¤§å° Quaternion Magnitude
è®¡ç®—å››å…ƒæ•°çš„å¤§å°ï¼Œå°±åƒè®¡ç®—å‘é‡å’Œå¤æ•°ä¸€æ ·
$$
\begin{aligned}
\|\mathbf{q}\| & =\left\|[w \quad(x \quad y \quad z)]\right\|=\sqrt{w^{2}+x^{2}+y^{2}+z^{2}} \\
& =\left\|[w \quad \boldsymbol{v}]\right\|=\sqrt{w^{2}+\|\boldsymbol{v}\|^{2}} .
\end{aligned}
$$
å››å…ƒæ•°åœ¨å‡ ä½•ä¸Šæ„å‘³ç€ä»€ä¹ˆ:
$$
\begin{aligned}
\|\mathbf{q}\| & =\left\|[w \quad \boldsymbol{v}]\right\|=\sqrt{w^{2}+\|\boldsymbol{v}\|^{2}} \\
& =\sqrt{\cos ^{2}(\theta / 2)+(\sin (\theta / 2)\|\hat{\boldsymbol{n}}\|)^{2}} \\
& =\sqrt{\cos ^{2}(\theta / 2)+\sin ^{2}(\theta / 2)\|\hat{\boldsymbol{n}}\|^{2}} \\
& =\sqrt{\cos ^{2}(\theta / 2)+\sin ^{2}(\theta / 2)(1)} \\
& =\sqrt{1} \\
& =1 .
\end{aligned}
$$

ä¸ºäº†æˆ‘ä»¬ä½¿ç”¨å››å…ƒæ•°è¡¨ç¤ºæ–¹å‘çš„ç›®çš„ï¼Œæ‰€æœ‰å››å…ƒæ•°éƒ½æ˜¯æ‰€è°“çš„å•ä½å››å…ƒæ•°ï¼Œå…¶**å¤§å°ç­‰äºå•ä½**ã€‚

## å››å…ƒæ•°å…±è½­å’Œé€† Quaternion Conjugate and Inverse
å››å…ƒæ•°çš„å…±è½­ï¼Œè¡¨ç¤ºä¸ºÂ Â $\mathbf{q^*}$ï¼Œæ˜¯é€šè¿‡å¯¹å››å…ƒæ•°çš„å‘é‡éƒ¨åˆ†å–è´Ÿæ¥è·å¾—çš„ï¼š
$$
\begin{aligned}
\mathbf{q^{*}} & =[w \quad \mathbf{v}]^{*}=[w \quad-\mathbf{v}] \\
& =[w \quad(x \quad y \quad z)]^{*}=[w \quad(-x \quad-y \quad-z)] .
\end{aligned}
$$

å››å…ƒæ•°çš„é€†è¡¨ç¤ºä¸º $\mathbf{q^{-1}}$,å®šä¹‰ä¸ºå››å…ƒæ•°é™¤ä»¥å…¶å¤§å°çš„å…±è½­ï¼š
$$
\mathbf{q^{-1}}=\frac{\mathbf{q^{*}}}{\mathbf{\|q\|}} .
$$
ä¸å®æ•° $a(a^{-1})=a^{-1}a=1$ ä¸åŒå››å…ƒæ•° $\mathbf{qq^{-1}} = [1 \ , 0]$ã€‚
å¦‚æœæ‚¨åªå¯¹è¡¨ç¤º**çº¯æ—‹è½¬çš„å››å…ƒæ•°**æ„Ÿå…´è¶£ï¼Œå°±åƒæˆ‘ä»¬åœ¨æœ¬ä¹¦ä¸­ä¸€æ ·ï¼Œé‚£ä¹ˆæ‰€æœ‰å››å…ƒæ•°éƒ½æ˜¯å•ä½å››å…ƒæ•°ï¼Œå› æ­¤**å…±è½­å’Œé€†æ˜¯ç­‰æ•ˆçš„**ã€‚å‡ºäºåè½¬çš„ç›®çš„å¦å®š $w$ï¼Œä¿æŒ $\mathbf{v}$ ä¸å˜ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†å…±è½­åœ¨å¤æ•°ä¸­å…·æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨è¿™ç§æ–¹å¼æ¥æ··æ·†å…±è½­æ¦‚å¿µã€‚

## å››å…ƒæ•°ä¹˜æ³• Quaternion Multiplication
å››å…ƒæ•°å¯ä»¥ç›¸ä¹˜ã€‚ç»“æœç±»ä¼¼äºå‘é‡çš„å‰ç§¯ï¼Œå› ä¸ºå®ƒäº§ç”Ÿå¦ä¸€ä¸ªå››å…ƒæ•°ï¼ˆä¸æ˜¯æ ‡é‡ï¼‰ï¼Œå¹¶ä¸”å®ƒä¸å¯äº¤æ¢ã€‚
$$
\begin{aligned}
\mathbf{q_1 q_2} &= [w_1 \begin{pmatrix} x_1 \ y_1 \ z_1 \end{pmatrix}][w_2 \begin{pmatrix} x_2 \ y_2 \ z_2 \end{pmatrix}] \\
&= \left[\begin{array}{c} w_1w_2 - x_1x_2 - y_1y_2 - z_1z_2 \\ w_1x_2 + x_1w_2 + y_1z_2 - z_1y_2 \\ w_1y_2 + y_1w_2 + z_1x_2 - x_1z_2 \\ w_1z_2 + z_1w_2 + x_1y_2 - y_1x_2 \end{array}\right] \\
&= [w_1 \quad \mathbf{v_1}][w_2 \quad \mathbf{v_2}] \\
&= [w_1w_2 - \mathbf{v}_1\cdot\mathbf{v}_2 \quad w_1\mathbf{v}_2 + w_2\mathbf{v}_1 + \mathbf{v}_1\times\mathbf{v}_2].
\end{aligned}
$$

å››å…ƒæ•°ç§¯ä¹Ÿç§°ä¸ºæ±‰å¯†å°”é¡¿ç§¯ã€‚
å››å…ƒæ•°ä¹˜æ³•æ»¡è¶³ç»“åˆå¾‹ï¼Œä½†ä¸æ»¡è¶³äº¤æ¢å¾‹ï¼š
$$
\begin{aligned}
(ab)c &= a(bc), \\
ab &\neq ba.
\end{aligned}
$$
å››å…ƒæ•°ä¹˜ç§¯çš„å¤§å°ç­‰äºå¤§å°çš„ä¹˜ç§¯ï¼š
$$
\|q_1 q_2\| = \|q_1\| \|q_2\|.
$$
å››å…ƒæ•°ä¹˜ç§¯çš„å€’æ•°ç­‰äºæŒ‰ç›¸åé¡ºåºå–çš„å€’æ•°çš„ä¹˜ç§¯ï¼š
$$
\begin{aligned}
(ab)^{-1} &= b^{-1} a^{-1}, \\
(q_1 q_2 \cdots q_{n-1} q_n)^{-1} &= q_n^{-1} q_{n-1}^{-1} \cdots q_2^{-1} q_1^{-1}.
\end{aligned}
$$

å¦‚ä½•ä½¿ç”¨ä»£è¡¨æ—‹è½¬çš„å››å…ƒæ•° $\mathbf{q}$ æ—‹è½¬å‘é‡ $\mathbf{p}$ï¼Œé¦–å…ˆè¦æŠŠ $\mathbf{p}$ ä»æ ‡å‡†ä¸‰ç»´å‘é‡æ‰©å±•åˆ°å››å…ƒæ•°ç©ºé—´ $\mathbf{p = [0,\ (x, \ y, \ z)]}$ï¼Œæ—‹è½¬å¾—åˆ°æ–°åæ ‡ $\mathbf{p'}$ï¼š
$$
\mathbf{p' = qpq^{-1}}
$$
å››å…ƒæ•°ä¹˜æ³•å¯ç”¨äºè¿æ¥å¤šä¸ªæ—‹è½¬ï¼Œå°±åƒçŸ©é˜µä¹˜æ³•ä¸€æ ·ã€‚å¤šä¸ªæ—‹è½¬çš„ä¸²è”å°†å§‹ç»ˆä»å³åˆ°å·¦â€œä»å†…åˆ°å¤–â€åœ°è¯»å–ã€‚
$$
\begin{aligned}
p' &= b(a p a^{-1}) b^{-1} \\
&= (ba) p (a^{-1} b^{-1}) \\
&= (ba) p (ba)^{-1}.
\end{aligned}
$$
## å››å…ƒæ•°â€œå·®â€ Quaternion â€œDifferenceâ€
è®¡ç®—ä¸¤ä¸ªå››å…ƒæ•°ä¹‹é—´çš„å·®å¼‚ï¼Œå…¶ä¸­â€œå·®å¼‚â€æ„å‘³ç€ä»ä¸€ä¸ªæ–¹å‘åˆ°å¦ä¸€ä¸ªæ–¹å‘çš„è§’ä½ç§»ã€‚
$$
\mathbf{da=b}
$$
$$
\begin{aligned}
(d a) a^{-1} &= b a^{-1}, \\
d\left(a a^{-1}\right) &= b a^{-1}, \\
d[1 \quad 0] &=b a^{-1}, \\
d &=b a^{-1} .
\end{aligned}
$$
$\mathbf{d}$ è¡¨ç¤ºçš„æ˜¯å››å…ƒæ•° $\mathbf{a}$ å’Œ $\mathbf{b}$ çš„è§’ä½ç§»ã€‚
## å››å…ƒæ•°ç‚¹ç§¯ Quaternion Dot Product
ç‚¹ç§¯è¿ç®—æ˜¯ä¸ºå››å…ƒæ•°å®šä¹‰çš„ã€‚æ­¤æ“ä½œçš„ç¬¦å·å’Œå®šä¹‰ä¸å‘é‡ç‚¹ç§¯éå¸¸ç›¸ä¼¼ï¼š
$$
\begin{aligned}
q_1 \cdot q_2 &= [w_1 \quad \mathbf{v}_1] \cdot [w_2 \quad \mathbf{v}_2] \\
&= w_1 w_2 + \mathbf{v}_1 \cdot \mathbf{v}_2 \\
&= [w_1 \begin{pmatrix} x_1 \ y_1 \ z_1 \end{pmatrix}] \cdot [w_2 \begin{pmatrix} x_2 \ y_2 \ z_2 \end{pmatrix}] \\
&= w_1 w_2 + x_1 x_2 + y_1 y_2 + z_1 z_2.
\end{aligned}
$$
ä¸å‘é‡ç‚¹ç§¯ä¸€æ ·ï¼Œç»“æœæ˜¯æ ‡é‡ã€‚å¯¹äºå•ä½å››å…ƒæ•°Â Â ğ‘å’ŒÂ Â ğ‘ã€Â Â âˆ’1â‰¤ğ‘â‹…ğ‘â‰¤1ã€‚
### ç‚¹ç§¯å‡ ä½•è§£é‡Š
å·®å¼‚å››å…ƒæ•° $\mathbf{d}$ ä¸­çš„ $w$ åˆ†é‡ç­‰äº $\mathbf{a} \cdot \mathbf{b}$ ã€‚å››å…ƒæ•°ç‚¹ç§¯ç»™å‡ºå°†ä¸€ä¸ªå››å…ƒæ•°æ—‹è½¬åˆ°å¦ä¸€ä¸ªå››å…ƒæ•°æ‰€éœ€çš„ä¸€åŠè§’åº¦çš„ä½™å¼¦ã€‚
å››å…ƒæ•°ç‚¹ç§¯å…·æœ‰ä¸å‘é‡ç‚¹ç§¯ç±»ä¼¼çš„è§£é‡Šã€‚å››å…ƒæ•°ç‚¹ç§¯ç»å¯¹å€¼è¶Šå¤§ï¼Œ$\mathbf{a}$ å’Œ $\mathbf{b}$ è¡¨ç¤ºçš„è§’ä½ç§»è¶Šâ€œç›¸ä¼¼â€ã€‚

## å››å…ƒæ•°å¯¹æ•° Quaternion logã€æŒ‡æ•° exp å’Œæ ‡é‡ä¹˜æ³• Multiplication by a Scalar
é€šè¿‡å¼•å…¥å˜é‡Â Â ğ›¼æ¥é‡æ–°è¡¨è¿°å››å…ƒæ•°çš„å®šä¹‰ï¼Œä»¥ç­‰äºåŠè§’Â Â ğœƒ/2ï¼š
$$
\begin{aligned}
\alpha = \theta/2, \
\mathbf{q} = [\cos\alpha \quad \hat{n}\sin\alpha].
\end{aligned}
$$

$\mathbf{q}$ çš„å¯¹æ•°å®šä¹‰ä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨ç¬¦å·Â $\equiv$ æ¥è¡¨ç¤ºå®šä¹‰ä¸Šçš„ç›¸ç­‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒÂ Â logâ¡ğ‘ä¸æ˜¯å•ä½å››å…ƒæ•°ã€‚
$$
\log \mathbf{q} = \log \left(\begin{array}{cc}
[\cos \alpha & \hat{\mathbf{n}} \sin \alpha]
\end{array}\right) \equiv \left[\begin{array}{cc}
0 & \alpha \hat{\mathbf{n}}
\end{array}\right] .
$$

æŒ‡æ•°å‡½æ•°çš„å®šä¹‰æ­£å¥½ç›¸åï¼š
$$
\exp \mathbf{p}=\exp \left(\begin{array}{ll}
[0 & \alpha \hat{\mathbf{n}}]
\end{array}\right) \equiv \left[\begin{array}{cc}
\cos \alpha & \hat{\mathbf{n}} \sin \alpha
\end{array}\right]
$$

ä¹Ÿå°±æ˜¯è¯´ï¼š
$$
\exp(\log \mathbf{q}) = \mathbf{q}
$$
å››å…ƒæ•°å¯ä»¥ä¹˜ä»¥æ ‡é‡ï¼Œç»“æœä»¥å°†æ¯ä¸ªåˆ†é‡ä¹˜ä»¥æ ‡é‡çš„æ˜æ˜¾æ–¹å¼è®¡ç®—:
$$
k \mathbf{q}=k[w \quad \mathbf{v}]=[k w \quad k \mathbf{v}] .
$$

â—è¿™é€šå¸¸ä¸ä¼šäº§ç”Ÿå•ä½å››å…ƒæ•°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¡¨ç¤ºè§’ä½ç§»çš„æƒ…å†µä¸‹ä¹˜ä»¥æ ‡é‡å¹¶ä¸æ˜¯éå¸¸æœ‰ç”¨çš„è¿ç®—ã€‚

## å››å…ƒæ•°å–å¹‚ Quaternion Exponentiation
å››å…ƒæ•°å¯ä»¥æ±‚å¹‚ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†å››å…ƒæ•°æé«˜åˆ°æ ‡é‡å¹‚ã€‚å››å…ƒæ•°å–å¹‚ï¼Œè¡¨ç¤ºä¸ºÂ $\mathbf{q^t}$ï¼Œå’ŒæŒ‡æ•°å‡½æ•°åŒºåˆ†ï¼Œå››å…ƒæ•°å–å¹‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼šå››å…ƒæ•°Â $\mathbf{q}$ å’Œæ ‡é‡æŒ‡æ•°Â Â ğ‘¡ã€‚

å››å…ƒæ•°å–å¹‚å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬æå–è§’ä½ç§»çš„â€œåˆ†æ•°â€ã€‚ä¾‹å¦‚ï¼Œè¦è®¡ç®—è¡¨ç¤ºå››å…ƒæ•°Â Â ğ‘æ‰€è¡¨ç¤ºçš„è§’ä½ç§»ä¸‰åˆ†ä¹‹ä¸€çš„å››å…ƒæ•°ï¼Œæˆ‘ä»¬å°†è®¡ç®—Â Â $\mathbf{q^{1/3}}$ï¼Œ$\mathbf{q^2}$ è¡¨ç¤ºä¸¤å€è§’ä½ç§»ã€‚

å››å…ƒæ•°ä½¿ç”¨æœ€çŸ­å¼§è¡¨ç¤ºè§’ä½ç§»ã€‚æ— æ³•è¡¨ç¤ºå¤šæ¬¡æ—‹è½¬ã€‚å¦‚æœéœ€è¦ç´¯è®¡æ—‹è½¬æ€»é‡ï¼Œæ›´å¥½çš„æ˜¯æ”¹ç”¨æŒ‡æ•°æ˜ å°„æˆ–è€…è½´è§’ã€‚
$$
\mathbf{q^t} = \exp(t \log \mathbf{q})
$$

## å››å…ƒæ•°æ’å€¼ Quaternion Interpolation, a.k.a. Slerp
å››å…ƒæ•°åœ¨æ¸¸æˆå’Œå›¾å½¢ä¸­å­˜åœ¨çš„ç†ç”±æ˜¯ä¸€ç§ç§°ä¸º slerp çš„è¿ç®—ï¼Œå®ƒä»£è¡¨çƒé¢çº¿æ€§æ’å€¼ã€‚
slerp å‡½æ•°Â Â $\mathbf{slerp(q_0,q_1, t)}$ è¿”å›ä»Â Â $\mathbf{q_0}$ æ’å€¼åˆ°Â Â $\mathbf{q_1}$ æ–¹å‘ `[0 , 1]`  ä¹‹é—´çš„å€¼ã€‚

æ ‡å‡†çº¿æ€§æ’å€¼å¦‚ä¸‹ï¼š
$$
\begin{aligned}
\Delta a &=a_{1}-a_{0}, \\
\operatorname{slerp}\left(a_{0}, a_{1}, t\right) &=a_{0}+t \Delta a .
\end{aligned}
$$
æ¨å¯¼å››å…ƒæ•°æ’å€¼å…¬å¼ï¼š
1. å››å…ƒæ•°ä¹‹é—´çš„å·®
$$
\Delta \mathbf{q} =\mathbf{q}_{1}\mathbf{q_0}^{-1}
$$

2. å–è¿™ä¸ªå·®å¼‚çš„ä¸€å°éƒ¨åˆ†
$$
\mathbf{(\Delta q)^t}
$$
3. å–åŸå§‹å€¼å¹¶æ ¹æ®å·®å€¼çš„è¿™ä¸€éƒ¨åˆ†è¿›è¡Œè°ƒæ•´
$$
\mathbf{(\Delta q)^t q_0}
$$
$$
\operatorname{slerp}\left(\mathbf{q_{0}, q_{1}}, t\right) = \left( \mathbf{q_1 q_0 ^ {-1}} \right)^t\mathbf{q_0}
$$
è¿™æ˜¯ç†è®ºä¸Šçš„è®¡ç®—å…¬å¼ï¼Œå®é™…ä¸Šä¼šä½¿ç”¨ç­‰æ•ˆä½†è®¡ç®—æ•ˆç‡æ›´é«˜çš„å…¬å¼ã€‚

è®¾å®šæ‰€æœ‰å››å…ƒæ•°éƒ½æ˜¯å•ä½å››å…ƒæ•°ï¼Œå®ƒä»¬å­˜åœ¨ 4D è¶…çƒé¢çš„è¡¨é¢ä¸Šï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯æ²¿ç€ 4D è¶…çƒé¢çš„è¡¨é¢å›´ç»•è¿æ¥ä¸¤ä¸ªå››å…ƒæ•°çš„å­¤è¿›è¡Œæ’å€¼ã€‚ï¼ˆå› æ­¤å¾—åçƒé¢çº¿æ€§æ’å€¼ã€‚ï¼‰

æƒ³è±¡ä¸€ä¸‹2D å­˜åœ¨å¤¹è§’ä¸º $\omega$ å¼§åº¦çš„ä¸¤ä¸ªäºŒç»´å‘é‡ $\mathbf{V_0}$ å’Œ $\mathbf{V_1}$ éƒ½æ˜¯å•ä½å‘é‡ã€‚$\mathbf{V_t}$ æ˜¯ä¸¤å‘é‡å¹³æ»‘ $t \omega$ çš„æ’å€¼å¾—åˆ°æ–°å•ä½å‘é‡ã€‚ä»å¦ä¸€ä¸ªè§†è§’çœ‹å­˜åœ¨éè´Ÿå¸¸æ•° $k_0$ å’Œ $k_1$ ä½¿å¾— $\mathbf{V_t}$ æ»¡è¶³çº¿æ€§ç»„åˆ:
$$
\mathbf{V_t} = k_0 \mathbf{V_0} + k_1 \mathbf{V_1}
$$
æ ¹æ®ä¸‰è§’å‡½æ•°ï¼Œåº”ç”¨äº $k_1\mathbf{V_1}$ ä½œä¸ºæ–œè¾¹çš„ä¸‰è§’å½¢:
$$
\begin{align}
k_1 \sin \omega \mathbf{\|V_1\|} = \sin t\omega \mathbf{\|V_t\|} \\
k_1= \frac{\sin t \omega}{\sin \omega }
\end{align}
$$
åŒç†å¯å¾—:
$$
k_0 =  \frac{\sin{(1-t)}\omega}{\sin \omega}
$$
å› æ­¤:
$$
\mathbf{V_t} = k_0\mathbf{V_0} + k_1\mathbf{V_1} = \frac{\sin{(1-t)}\omega}{\sin \omega}\mathbf{V_0} + \frac{\sin t \omega}{\sin \omega }\mathbf{V_1}
$$
å°†æ€æƒ³æ‰©å±•åˆ°å››å…ƒæ•°ç©ºé—´ï¼Œé‡æ–°è¡¨ç¤º slerp:
$$
\operatorname{slerp}\left(\mathbf{q_{0}, q_{1}}, t\right) = \frac{\sin{(1-t)}\omega}{\sin \omega}\mathbf{q_0} + \frac{\sin t \omega}{\sin \omega }\mathbf{q_1}
$$

## å››å…ƒæ•°ä¼˜åŠ£åŠ¿
ä¼˜åŠ¿ï¼šslerp æä¾›çš„æ’å€¼æä¾›äº†æ–¹å‘ä¹‹é—´çš„å¹³æ»‘æ’å€¼ï¼Œå››å…ƒæ•°å…±è½­æä¾›äº†ä¸€ç§éå¸¸æœ‰æ•ˆåœ°è®¡ç®—ç›¸åè§’ä½ç§»çš„æ–¹æ³•ï¼Œå››å…ƒæ•°ä¸çŸ©é˜µå½¢å¼ä¹‹é—´çš„è½¬æ¢é€Ÿåº¦æ¯”æ¬§æ‹‰è§’è¦å¿«ä¸€äº›ï¼Œç”±äºå››å…ƒæ•°åŒ…å«å››ä¸ªæ ‡é‡å€¼ï¼Œå› æ­¤å®ƒæ¯”ä½¿ç”¨ä¹ä¸ªæ•°å­—çš„çŸ©é˜µè¦ç»æµå¾—å¤š

åŠ£åŠ¿ï¼šå››å…ƒæ•°æ˜¯äººç±»æœ€éš¾ç›´æ¥ä½¿ç”¨çš„ï¼Œç”±äºé”™è¯¯çš„è¾“å…¥æ•°æ®æˆ–ç´¯ç§¯çš„æµ®ç‚¹èˆå…¥è¯¯å·®å¯¼è‡´å››å…ƒæ•°å¯èƒ½ä¼šå¤±æ•ˆï¼Œæ¯”æ¬§æ‹‰è§’å­˜å‚¨å ç”¨ç¨å¤§

## å››å…ƒæ•°ä½œä¸ºå¤æ•° Quaternions as Complex Numbers
å¤§å¤šæ•°æ–‡ç« éƒ½æ˜¯å°†å››å…ƒæ•°å½“ä½œå¤æ•°è®¨è®ºï¼Œå¦‚æœåªæ˜¯ç”¨äºæ—‹è½¬çš„å››å…ƒæ•°ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ç”¨æ·±ç©¶å¤æ•°ç†è§£ã€‚ä½†æ˜¯ä»¥ä¸‹å†…å®¹å¯ä»¥è§£é‡Š $\theta / 2$ å’Œ $qpq^{-1}$ çš„ç”±æ¥ã€‚

> æœ¬ç« éµå¾ªå¾·ä¿ç½—å¤§å­¦çš„çº¦ç¿°Â·éº¦å…‹å”çº³æå‡ºçš„æ–¹æ³•

å¤æ•°å¯¹æ˜¯ç”± $(a, b)$ å®šä¹‰äº† $a + bi$,æ•°å­— $i$ æ˜¯ä¸€ä¸ªç‰¹æ®Šæ•°ï¼Œ$i^2 = -1$ è¿™åœ¨å®æ•°ä¸­å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä½¿ç”¨"è™šæ•°"æˆ–â€œå¤åˆ(complex)â€ï¼Œæˆ‘ä»¬ä½¿ç”¨ 2 X 2 çŸ©é˜µé›†è¡¨ç¤ºå¤æ•°ã€‚
å¯¹äºä»»ä½•æ ‡é‡çŸ©é˜µé›†åµŒå…¥è¡¨ç¤ºå¦‚ä¸‹ï¼Œå¤æ•°å¯¹ä¸­çš„å®éƒ¨ï¼ˆrealï¼‰åŒæ ·è¡¨ç¤º:
$$
a \equiv
\left[\begin{matrix}{}
a & 0 \\
0 & a
\end{matrix}\right]
$$
ä¿ç•™äº†æ‰€æœ‰æ™®é€šçš„åŠ æ³•ã€å‡æ³•å’Œä¹˜æ³•çš„ä»£æ•°å®šå¾‹ï¼šç»“åˆå¾‹ã€åˆ†é…å¾‹ã€é›¶çš„ä¸å¯åˆ†è§£æ€§ã€‚
æ‰©å±• 2X 2çŸ©é˜µç©ºé—´ä¸­çš„åµŒå…¥æ•°å­—ç³»ç»Ÿä»¥åŒ…å«å¤æ•°ï¼š
$$
a + bi \equiv
\left[\begin{matrix}{}
a & -b \\
b & a
\end{matrix}\right]
$$

è¯¥æ–¹å¼èƒ½å¤Ÿå¾ˆå¥½éªŒè¯å¤æ•°çš„åŠ ã€å‡å’Œä¹˜æ³•ã€‚ä»¥åŠ $i^2 = -1$ åŒæ ·æˆç«‹ã€‚
$$
\mathrm{i}^2=\left[\begin{array}{cc}
0 & -\mathrm{1} \\
\mathrm{1} & 0
\end{array}\right]^{2}=\left[\begin{array}{cc}
0 & -\mathrm{1} \\
\mathrm{1} & 0
\end{array}\right]\left[\begin{array}{cc}
0 & -\mathrm{1} \\
\mathrm{1} & 0
\end{array}\right]=\left[\begin{array}{cc}
-\mathrm{1} & 0 \\
0 & -\mathrm{1}
\end{array}\right]=-1 .
$$

å¤æ•°æœ‰ä»¥ä¸‹è¿ç®—æ³•åˆ™:
$$
\begin{align}
\mathrm{(a + bi) + (c+di) \equiv (a+c)+(c+d)i} \\
\mathrm{((a + bi) - (c+di) \equiv (a-c)+(c-d)i} \\
\mathrm{(a+bi)(c+di) \equiv (ac -bd)+(ad + bc)i}
\end{align}
$$

ä¸è¦å°†Â Â ğ‘–è§†ä¸ºÂ Â âˆ’1çš„å¹³æ–¹æ ¹ï¼Œè€Œä¸è¦å°†å¤æ•°Â Â ğ‘+ğ‘ğ‘–è§†ä¸ºå…·æœ‰ä¸¤ä¸ªè‡ªç”±åº¦çš„æ•°å­¦å®ä½“ã€‚
ç°åœ¨å‘ç° 2D æ—‹è½¬è§’åº¦çš„çŸ©é˜µåˆšå¥½èƒ½ç”¨å¤æ•°å½¢å¼æ±‚å¾—:
$$
\cos\theta + i \sin\theta \equiv 
\left[\begin{matrix}{}
\cos\theta & -\sin\theta \\
\sin\theta & \cos\theta
\end{matrix}\right]
$$

â—æ³¨æ„è¯¥çŸ©é˜µå’Œç¬¬äº”ç« èŠ‚æ±‚å¾—çŸ©é˜µæœ‰ç»†å¾®å‡ºå…¥ï¼Œåº”ä¸ºè¯¥çŸ©é˜µç”¨äºå·¦ä¹˜ã€‚
ğŸ”i çš„ä¹˜æ³•è¢«è§£é‡Šä¸º 90 åº¦æ—‹è½¬ã€‚
å››å…ƒæ•°çš„å…±è½­è¡¨ç¤ºåè§’ä½ç§»ã€‚å¯¹äºè½¬ç½®æ—‹è½¬çŸ©é˜µæ¥è¯´ï¼Œç›¸åº”çš„äº‹å®æ˜¯æ­£ç¡®çš„ï¼šç”±äºå®ƒä»¬æ˜¯æ­£äº¤çš„ï¼Œå› æ­¤å®ƒä»¬çš„è½¬ç½®ç­‰äºå®ƒä»¬çš„é€†çŸ©é˜µã€‚
æ™®é€šçš„äºŒç»´å‘é‡å¦‚ä½•é€‚åº”è¿™ä¸ªæ–¹æ¡ˆï¼Ÿæˆ‘ä»¬å°†å‘é‡Â $[x,y]$ è§£é‡Šä¸ºå¤æ•°Â $x + iy$ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è§£é‡Šä¸¤ä¸ªå¤æ•°çš„ä¹˜æ³•
$$
\begin{aligned}
(\cos \theta+i \sin \theta)(x+i y) &=x \cos \theta+i y \cos \theta+i x \sin \theta+i^{2} y \sin \theta \\
&=(x \cos \theta-y \sin \theta)+i(x \sin \theta+y \cos \theta)
\end{aligned}
$$

ä½œä¸ºæ‰§è¡Œæ—‹è½¬ã€‚è¿™ç›¸å½“äºçŸ©é˜µä¹˜æ³•
$$
\left[\begin{array}{cc}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta
\end{array}\right]\left[\begin{array}{l}
x \\
y
\end{array}\right]=\left[\begin{array}{l}
x \cos \theta-y \sin \theta \\
x \sin \theta+y \cos \theta
\end{array}\right] .
$$


ä»¥ä¸Šæ¨å¯¼äº† 2D ä¸­å‘é‡è§£é‡Šä¸ºå¤æ•°å¹¶ä½¿ç”¨å¤æ•°ä¹˜æ³•å¯¹å…¶æ—‹è½¬çš„è®¡ç®—è¿‡ç¨‹ã€‚
ä¸ºäº†å°†å››å…ƒæ•°å’Œ 3D å‘é‡ç›¸ä¹˜ï¼Œéœ€è¦è¿›è¡Œç±»ä¼¼çš„è½¬æ¢ã€‚

> ä» 2 D åˆ° 3 D æ— æ³•ä½¿ç”¨ç›¸åŒçš„æŠ€å·§æ‰©å±•ã€‚å¨å»‰Â·ç½—æ–‡Â·æ±‰å¯†å°”é¡¿ 1843 å¹´æ„è¯†åˆ°è¯¥æ‰©å±•æ–¹å¼éœ€è¦çš„ä¸æ˜¯ä¸¤ä¸ªè™šéƒ¨è€Œæ˜¯ä¸‰ä¸ªï¼Œä»–åœ¨æ‰«å¸šæ¡¥ï¼ˆ**å¸ƒé²å§†æ¡¥**ï¼‰ä¸Šåˆ»ä¸‹äº†å®šä¹‰è¿™ç§æ–°å‹å¤æ•°å±æ€§çš„æ–¹ç¨‹ï¼Œäºæ˜¯å››å…ƒæ•°å°±è¢«å‘æ˜äº†ã€‚

å››å…ƒç´ ä¸­é€šè¿‡ä¸‰ä¸ªè™šæ•° i ã€j å’Œ k æ‰©å±•äº†å¤æ•°ç³»ç»Ÿï¼Œè¿™ä¸‰ä¸ªè™šæ•°ä¸ Hamilton è‘—åçš„æ–¹ç¨‹ç›¸å…³ï¼š
$$
\begin{aligned}
\mathrm{i}^{2} &=\mathrm{j}^{2}=\mathrm{k}^{2}=-1 \\
\mathrm{ij} &=\mathrm{k}, \quad \mathrm{ji}=-\mathrm{k}, \\
\mathrm{jk} &=\mathrm{i}, \quad \mathrm{kj}=-\mathrm{i}, \\
\mathrm{ki} &=\mathrm{j}, \quad \mathrm{ik}=-\mathrm{j} .
\end{aligned}
$$

è¡¨ç¤ºå››å…ƒæ•° $\mathrm{[w, \ (x ,\ y,\ z)]}$ å¯¹åº”å¤æ•° $\mathrm{w + xi + yi + zk}$ã€‚ç°åœ¨é‡æ–°å°†å››å…ƒæ•°åµŒå…¥çŸ©é˜µé›†åˆå½“ä¸­ã€‚
$$
\mathrm{a} = 
\left[\begin{matrix} 
\mathrm{a} & 0 & 0 & 0 \\
0 & \mathrm{a} & 0 & 0 \\
0 & 0 & \mathrm{a} & 0 \\
0 & 0 & 0 & \mathrm{a}
\end{matrix}\right]
$$

$$
\begin{aligned}
\mathrm{i} &=\left[\begin{array}{rrrr}
0 & 0 & 0 & 1 \\
0 & 0 & -1 & 0 \\
0 & 1 & 0 & 0 \\
-1 & 0 & 0 & 0
\end{array}\right], \quad \mathrm{j}=\left[\begin{array}{rrrr}
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
-1 & 0 & 0 & 0 \\
0 & -1 & 0 & 0
\end{array}\right], \quad \mathrm{k}=\left[\begin{array}{rrrr}
0 & -1 & 0 & 0 \\
1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 \\
0 & 0 & -1 & 0
\end{array}\right] .
\end{aligned}
$$
ç»“åˆä¸Šè¿°å…³è”ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»æ„å››å…ƒæ•°æ˜ å°„åˆ°Â Â 4 X 4çŸ©é˜µï¼š
$$
\mathrm{w}+\mathrm{x} \mathrm{i}+\mathrm{y} \mathrm{j}+\mathrm{z} \mathrm{k}=\left[\begin{array}{rrrr}
\mathrm{w} & -\mathrm{z} & \mathrm{y} & \mathrm{x} \\
\mathrm{z} & \mathrm{w} & -\mathrm{x} & \mathrm{y} \\
-\mathrm{y} & \mathrm{x} & \mathrm{w} & \mathrm{z} \\
-\mathrm{x} & -\mathrm{y} & -\mathrm{z} & \mathrm{w}
\end{array}\right] .
$$

çœç•¥ 2 D åˆ°å››å…ƒæ•°çš„çŸ©é˜µè®¡ç®—æ¨å¯¼ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºç»“è®ºã€‚å°†å‘é‡ $\mathrm{[x , y ,z]}$ è½¬åŒ–ä¸ºå››å…ƒæ•° $\mathrm{v = [0,(x,y,z)]}$ã€‚å°†å‘é‡å›´ç»• $\hat n$ æ—‹è½¬è§’åº¦ $\theta$ çš„ç›´æ¥æ–¹æ³•æ˜¯åˆ›å»ºå››å…ƒæ•° $\mathrm{q} = [\cos\theta , \sin\theta \hat n]$ï¼Œç„¶åæ‰§è¡Œå·¦ä¹˜ $\mathrm{qv}$ æ—‹è½¬ã€‚ä½†ä¹˜æ³•ä¼šäº§ç”Ÿä¸€äº›ä¸éœ€è¦çš„æ—‹è½¬, å³ä¾§ä¹˜ä»¥å…±è½­ $\mathrm{vq^*}$ è·å¾—æ‰€éœ€ç›¸åŒçš„æ—‹è½¬ï¼Œå¹¶ä¸”äº§ç”Ÿç›¸åä¸”ä¸€æ ·çš„éœ€è¦æ—‹è½¬ï¼Œæ‰€ä»¥ $\mathrm{qvq*}$ å¾—åˆ°åŒå€çš„æ­£ç¡®æ—‹è½¬å¹¶ä¸”ä¸­å’Œäº†ä¸éœ€è¦çš„æ—‹è½¬ï¼Œè§£å†³æ–¹æ¡ˆç®€å•çš„ä½¿ç”¨è§’åº¦çš„ä¸€åŠè®¡ç®— $\mathrm{q} = [\cos(\mathrm{\theta / 2}), \sin(\theta /2) \hat n]$ ã€‚ç¬¬ä¸€æ¬¡æ—‹è½¬æ—‹è½¬åˆ°ç›®æ ‡çš„ä¸€åŠï¼ŒåŠ ä¸Šä¸€äº›æ¶‰åŠÂ Â ğ‘¤çš„ä¸éœ€è¦çš„æ—‹è½¬ã€‚ç¬¬äºŒæ¬¡æ—‹è½¬å®Œæˆæ‰€éœ€çš„æ—‹è½¬ï¼ŒåŒæ—¶å–æ¶ˆä¸éœ€è¦çš„æ—‹è½¬ã€‚

# å››å…ƒæ•°æ€»ç»“
- ä»æ¦‚å¿µä¸Šè®²ï¼Œå››å…ƒæ•°é€šè¿‡ä½¿ç”¨æ—‹è½¬è½´å’Œç»•è¯¥è½´çš„æ—‹è½¬é‡æ¥è¡¨è¾¾è§’ä½ç§»ã€‚
- å››å…ƒæ•°åŒ…å«æ ‡é‡åˆ†é‡Â $w$ å’Œå‘é‡åˆ†é‡Â Â $v$ã€‚å®ƒä»¬ä¸æ—‹è½¬è§’åº¦Â Â $\theta$ å’Œæ—‹è½¬è½´Â $\hat n$ çš„å…³ç³»ä¸º
$$
\mathrm{w = \cos(\theta / 2), v = \hat n \sin(\theta / 2)}
$$
- 3 D ä¸­çš„æ¯ä¸ªè§’ä½ç§»åœ¨å››å…ƒæ•°ç©ºé—´ä¸­éƒ½æœ‰ä¸¤ç§ä¸åŒçš„è¡¨ç¤ºï¼Œå¹¶ä¸”å®ƒä»¬äº’ä¸ºè´Ÿæ•°
- è¡¨ç¤ºâ€œæ— è§’ä½ç§»â€çš„æ’ç­‰å››å…ƒæ•°æ˜¯Â Â $[1 , 0]$
- æ‰€æœ‰è¡¨ç¤ºè§’ä½ç§»çš„å››å…ƒæ•°éƒ½æ˜¯â€œå•ä½å››å…ƒæ•°â€ï¼Œå…¶å¤§å°ç­‰äº 1ã€‚
- å››å…ƒæ•°çš„å…±è½­è¡¨ç¤ºç›¸åçš„è§’ä½ç§»ï¼Œå¹¶é€šè¿‡å¯¹å‘é‡éƒ¨åˆ†Â v æ±‚åæ¥è®¡ç®—ã€‚å››å…ƒæ•°çš„å€’æ•°æ˜¯å…±è½­é™¤ä»¥å¤§å°ã€‚å¦‚æœä»…ä½¿ç”¨å››å…ƒæ•°æ¥æè¿°è§’ä½ç§»ï¼Œé‚£ä¹ˆå…±è½­å’Œå€’æ•°æ˜¯ç­‰æ•ˆçš„ã€‚
- å››å…ƒæ•°ä¹˜æ³•å¯ç”¨äºå°†å¤šä¸ªæ—‹è½¬è¿æ¥æˆå•ä¸ªè§’ä½ç§»ã€‚ç†è®ºä¸Šï¼Œå››å…ƒæ•°ä¹˜æ³•ä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡Œ 3 D å‘é‡æ—‹è½¬ï¼Œä½†è¿™å®ç”¨ä»·å€¼ä¸å¤§ã€‚
- å››å…ƒæ•°æ±‚å¹‚å¯ç”¨äºè®¡ç®—è§’ä½ç§»çš„å€æ•°ã€‚è¿™æ€»æ˜¯æ•è·æ­£ç¡®çš„æœ€ç»ˆç»“æœï¼›ç„¶è€Œï¼Œç”±äºå››å…ƒæ•°æ€»æ˜¯é‡‡ç”¨æœ€çŸ­çš„å¼§ï¼Œå› æ­¤æ— æ³•è¡¨ç¤ºå¤šæ¬¡æ—‹è½¬ã€‚
- å››å…ƒæ•°å¯ä»¥è§£é‡Šä¸º 4 D å¤æ•°ï¼Œè¿™åœ¨æ•°å­¦å’Œå‡ ä½•ä¹‹é—´åˆ›é€ äº†æœ‰è¶£è€Œä¼˜é›…çš„ç›¸ä¼¼ä¹‹å¤„ã€‚

# è¡¨ç¤ºå½¢å¼è½¬æ¢
## å°†æ¬§æ‹‰è§’è½¬æ¢ä¸ºçŸ©é˜µ Euler Angles to a Matrix
ç‰©ä½“åˆ°ç›´ç«‹æ—‹è½¬çŸ©é˜µçš„ç”Ÿæˆæ˜¯ä¸‰ä¸ªç®€å•æ—‹è½¬çŸ©é˜µçš„ç›´æ¥ä¸²è”
$$
\mathrm{M_{object \rightarrow upright}} = \mathrm{BPH}
$$
å…¶ä¸­ Bã€p å’Œ H æ˜¯å¡åº¦ã€ä¿¯ä»°å’Œèˆªå‘çš„æ—‹è½¬çŸ©é˜µï¼Œä»–ä»¬åˆ†åˆ«å›´ç»• zã€x å’Œ y è½´æ—‹è½¬ã€‚
$$
\begin{aligned}
\mathbf{B} & =\mathbf{R}_{\mathrm{z}}(\mathrm{b})=\left[\begin{array}{ccc}
\cos \mathrm{b} & \sin \mathrm{b} & 0 \\
-\sin \mathrm{b} & \cos \mathrm{b} & 0 \\
0 & 0 & 1
\end{array}\right], \\
\mathbf{P} & =\mathbf{R}_{\mathrm{x}}(\mathrm{p})=\left[\begin{array}{ccc}
1 & 0 & 0 \\
0 & \cos \mathrm{p} & \sin \mathrm{p} \\
0 & -\sin \mathrm{p} & \cos \mathrm{p}
\end{array}\right], \\
\mathbf{H} & =\mathbf{R}_{\mathrm{y}}(\mathrm{h})=\left[\begin{array}{ccc}
\cosh & 0 & -\sinh \\
0 & 1 & 0 \\
\sinh & 0 & \cosh
\end{array}\right] .
\end{aligned}
$$

ä¸²è”åå¾—åˆ°
$$
\mathrm{M_{object \rightarrow upright}} = \mathrm{BPH} =
\left[\begin{array}{lll}
\mathrm{chcb}+\mathrm{shspsb} & \mathrm{sbcp} & -\mathrm{shcb}+\mathrm{chspsb} \\
-\mathrm{chsb}+\mathrm{shspcb} & \mathrm{cbcp} & \mathrm{sbsh}+\mathrm{chspcb} \\
\mathrm{shcp} & -\mathrm{sp} & \mathrm{chcp}
\end{array}\right]
$$
ä¸ºäº†å°†å‘é‡ä»ç›´ç«‹ç©ºé—´æ—‹è½¬åˆ°å¯¹è±¡ç©ºé—´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å¯¹è±¡åˆ°ç›´ç«‹çŸ©é˜µçš„é€†çŸ©é˜µã€‚
$$
\mathrm{M_{upright \rightarrow object}} = 
\mathrm{B^{-1}P^{-1}H^{-1}} =
\left[\begin{array}{lll}
\mathrm{chcb}+\mathrm{shspsb} & -\mathrm{chsb}+\mathrm{shspcb} & \mathrm{shap} \\
\mathrm{sbcp} & \mathrm{cbcp} & -\mathrm{sp} \\
-\mathrm{shcb}+\mathrm{chspsb} & \mathrm{sbsh}+\mathrm{chspcb} & \mathrm{chap}
\end{array}\right] .
$$

## å°†çŸ©é˜µè½¬æ¢ä¸ºæ¬§æ‹‰è§’ Matrix to Euler angles
æ ¹æ®å¯¹è±¡ç©ºé—´è½¬ç›´ç«‹ç©ºé—´çš„çŸ©é˜µ
$$
\left[\begin{array}{lll}
\cosh \cos \mathrm{b}+\sinh \sin \mathrm{p} \sin \mathrm{b} & \sin \mathrm{b} \cos \mathrm{p} & -\sin \mathrm{h} \cos \mathrm{b}+\cos \mathrm{h} \sin \mathrm{p} \sin \mathrm{b} \\
-\cosh \sin \mathrm{b}+\sinh \sin \mathrm{p} \cos \mathrm{b} & \cos \mathrm{b} \cos \mathrm{p} & \sin \mathrm{b} \sin \mathrm{h}+\cos \mathrm{h} \sin \mathrm{p} \cos \mathrm{b} \\
\sin \mathrm{h} \cos \mathrm{p} & -\sin \mathrm{p} & \cos \mathrm{h} \cos \mathrm{p}
\end{array}\right] .
$$

ä» $m_{32}$ æ±‚è§£ pï¼š
$$
\begin{aligned}
m_{32} &=-\sin \mathrm{p}, \\
-m_{32} &=\sin \mathrm{p}, \\
\arcsin \left(-m_{32}\right) &=\mathrm{p} .
\end{aligned}
$$

ç„¶åæˆ‘ä»¬æ ¹æ® p ï¼Œä¹Ÿå¾—åˆ°äº† $\cos\mathrm{p}$ï¼Œæ ¹æ®çŸ©é˜µå…¶ä»–å…ƒç´ æ±‚å¾—ï¼š
$$
\begin{aligned}
m_{31} &=\sinh \cos \mathrm{p}, \quad m_{33}=\cosh \cos \mathrm{p}, \\
m_{31} / \cos \mathrm{p} &=\sinh, \quad m_{33} / \cos \mathrm{p}=\cosh .
\end{aligned}
$$

æ ¹æ® atan2 è®¡ç®—è§’åº¦çš„å€¼ï¼š
$$
\mathrm{h}=\operatorname{atan2}(\sinh , \cosh )=\operatorname{atan2}\left(m_{31} / \cos \mathrm{p}, m_{33} / \cos \mathrm{p}\right)
=\operatorname{atan2}\left(m_{31}, m_{33}\right)
$$
Bank çš„è®¡ç®—æ–¹å¼ç±»ä¼¼ï¼š
$$
\begin{aligned}
m_{12} &=\sin \mathrm{b} \cos \mathrm{p}, \\
m_{12} / \cos \mathrm{p} &=\sin \mathrm{b}, \\
m_{22} &=\cos \mathrm{b} \cos \mathrm{p}, \\
m_{22} / \cos \mathrm{p} &=\cos \mathrm{b}, \\
\mathrm{b} &=\operatorname{atan2}(\sin \mathrm{b} \cos \mathrm{b})=\operatorname{atan2}\left(m_{12} / \cos \mathrm{p}, m_{22} / \cos \mathrm{p}\right) \\
&=\operatorname{atan2}\left(m_{12}, m_{22}\right) .
\end{aligned}
$$
å¦‚æœ $\cos \mathrm{p} = 0$ï¼Œå°†å‡ºç° $\mathrm{p} = \pm 90^\circ$ è¿™å°±æ„å‘³ç€å‡ºç°ä¸‡å‘èŠ‚é”å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»»æ„çš„å°†æ‰€æœ‰ç»•å‚ç›´è½´çš„æ—‹è½¬åˆ†ç»™â€œheadingâ€ï¼Œå¹¶å°† â€œBankâ€ è®¾ç½®ä¸º 0ï¼Œä¹Ÿå°±æ˜¯åªæ±‚è§£ hã€‚
$$
\cos \mathrm{p} = 0 , \mathrm{b} = 0, \sin \mathrm{b} = 0, \cos \mathrm{b} = 1
$$
å¸¦å…¥æ—‹è½¬çŸ©é˜µå¾—åˆ°ï¼š
$$
\left[\begin{array}{ccc}
\cosh & 0 & -\sinh \\
\sinh \sin \mathrm{p} & 0 & \cosh \sin \mathrm{p} \\
0 & -\sin \mathrm{p} & 0
\end{array}\right] .
$$
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»Â Â $-m_{13}$ å’ŒÂ $m_{11}$ è®¡ç®—Â Â hï¼Œå®ƒä»¬åˆ†åˆ«åŒ…å«èˆªå‘çš„æ­£å¼¦å’Œä½™å¼¦ã€‚

## å°†å››å…ƒæ•°è½¬æ¢ä¸ºçŸ©é˜µ Quaternion to a Matrix
ç”±äºå››å…ƒæ•°æœ¬è´¨ä¸Šæ˜¯è½´è§’æ—‹è½¬çš„ç¼–ç ç‰ˆæœ¬ï¼Œå› æ­¤æ ¹æ®ç»•ä»»æ„è½´çš„æ„é€ çŸ©é˜µè¿›è¡Œæ¨å¯¼ã€‚
$$
\begin{bmatrix}
n_x^2(1-\cos{\theta}) + \cos{\theta} & n_x n_y (1-\cos{\theta}) + n_z \sin{\theta} & n_x n_z (1-\cos{\theta}) - n_y \sin{\theta} \\
n_x n_y (1-\cos{\theta}) - n_z \sin{\theta} & n_y^2(1-\cos{\theta}) + \cos{\theta} & n_y n_z (1-\cos{\theta}) + n_x \sin{\theta} \\
n_x n_z (1-\cos{\theta}) + n_y \sin{\theta} & n_y n_z (1-\cos{\theta}) - n_x \sin{\theta} & n_z^2(1-\cos{\theta}) + \cos{\theta}
\end{bmatrix}.
$$
å››å…ƒæ•°çš„åˆ†é‡è®¡ç®—å…¬å¼
$$
{[w \quad(x \quad y \quad z)] } =\left[\cos (\theta / 2) \quad(\sin (\theta / 2) n_{x} \quad \sin (\theta / 2) n_{y} \quad \sin (\theta / 2) n_{z})\right] .
$$
æœ€ç»ˆå¾—åˆ°ï¼Œå¦‚æœæ„Ÿå…´è¶£è¿™éƒ¨åˆ†æ¨ç†è¿‡ç¨‹ï¼Œè¯·æ·±å…¥é˜…è¯»[EquationÂ (8.20)](https://gamemath.com/book/orient.html#quaternion_to_matrix).
$$
\left[\begin{array}{ccc}
1-2 y^{2}-2 z^{2} & 2 x y+2 w z & 2 x z-2 w y \\
2 x y-2 w z & 1-2 x^{2}-2 z^{2} & 2 y z+2 w x \\
2 x z+2 w y & 2 y z-2 w x & 1-2 x^{2}-2 y^{2}
\end{array}\right] .
$$

## å°†çŸ©é˜µè½¬æ¢ä¸ºå››å…ƒæ•° Matrix to a Quaternion
è¿™æ˜¯å¯¹ QtM çŸ©é˜µçš„é€†å‘å·¥ç¨‹ã€‚æ£€æŸ¥å¯¹è§’çº¿å…ƒç´ çš„æ€»å’Œï¼ˆç§°ä¸ºçŸ©é˜µçš„è¿¹ï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°
$$
\begin{aligned}
\operatorname{tr}(\mathrm{M}) &=\mathrm{m}_{11}+\mathrm{m}_{22}+\mathrm{m}_{33} \\
&=\left(1-2 y^{2}-2 z^{2}\right)+\left(1-2 x^{2}-2 z^{2}\right)+\left(1-2 x^{2}-2 y^{2}\right) \\
&=3-4\left(x^{2}+y^{2}+z^{2}\right) \\
&=3-4(1-w^{2}) \\
&=4 w^{2}-1,
\end{aligned}
$$
æ‰€ä»¥

$$
\mathrm{w}=\frac{\sqrt{\mathrm{m}_{11}+\mathrm{m}_{22}+\mathrm{m}_{33}+1}}{2} .
$$

å…¶ä»–ä¸‰ä¸ªå…ƒç´ å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼è®¡ç®—ï¼Œé€šè¿‡å¯¹è·Ÿè¸ªä¸­ä¸‰ä¸ªå…ƒç´ ä¸­çš„ä¸¤ä¸ªæ±‚åï¼š

$$
\begin{array}{}
\mathrm{m}_{11} - \mathrm{m}_{22} - \mathrm{m}_{33} &= 4x^2 - 1 , \\
-\mathrm{m}_{11} + \mathrm{m}_{22} - \mathrm{m}_{33} &= 4y^2 -1, \\
-\mathrm{m}_{11} - \mathrm{m}_{22} + \mathrm{m}_{33} &= 4z^2 - 1, \\
\mathrm{x} &=\frac{\sqrt{\mathrm{m}_{11}-\mathrm{m}_{22}-\mathrm{m}_{33}+1}}{2} , \\
\mathrm{y} &=\frac{\sqrt{-\mathrm{m}_{11}+\mathrm{m}_{22}-\mathrm{m}_{33}+1}}{2} , \\
\mathrm{z} &=\frac{\sqrt{-\mathrm{m}_{11}-\mathrm{m}_{22}+\mathrm{m}_{33}+1}}{2} .
\end{array}
$$

ä¸èƒ½å¯¹æ‰€æœ‰å››ä¸ªåˆ†é‡ä½¿ç”¨è¿™ä¸ªæŠ€å·§ï¼Œå› ä¸ºå¹³æ–¹æ ¹æ€»æ˜¯ä¼šäº§ç”Ÿæ­£ç»“æœã€‚
å¦ä¸€ç§æ¨å¯¼æ–¹å¼æ˜¯æ£€æŸ¥å¯¹è§’ç›¸åçš„çŸ©é˜µå…ƒç´ çš„å’Œä¸å·®ï¼š
$$
\begin{aligned}
m_{12}+m_{21}=(2xy+2wz)+(2xy-2wz)=4xy,\\
m_{12}-m_{21}=(2xy+2wz)-(2xy-2wz)=4wz,\\
m_{31}+m_{13}=(2xz+2wy)+(2xz-2wy)=4xz,\\
m_{31}-m_{13}=(2xz+2wy)-(2xz-2wy)=4wy,\\
m_{23}+m_{32}=(2yz+2wx)+(2yz-2wx)=4yz,\\
m_{23}-m_{32}=(2yz+2wx)-(2yz-2wx)=4wx.
\end{aligned}
$$
åˆ©ç”¨ä¸Šä¸€ä¸ªæ–¹æ³•æ±‚å¾—çš„ä»»æ„ä¸€ä¸ªå€¼æ¨å¯¼å‡ºå…¶ä»–åˆ†é‡ï¼Œæœ‰å››ç§é€‰æ‹©ã€‚
$$
\begin{aligned}
w=\frac{\sqrt{m_{11}+m_{22}+m_{33}+1}}{2}\quad\Rightarrow\quad x=\frac{m_{23}-m_{32}}{4w},\ y=\frac{m_{31}-m_{13}}{4w},\ z=\frac{m_{12}-m_{21}}{4w}\\
x=\frac{\sqrt{m_{11}-m_{22}-m_{33}+1}}{2}\quad\Rightarrow\quad w=\frac{m_{23}-m_{32}}{4x},\ y=\frac{m_{12}+m_{21}}{4x},\ z=\frac{m_{31}+m_{13}}{4x}\\
y=\frac{\sqrt{-m_{11}+m_{22}-m_{33}+1}}{2}\quad\Rightarrow\quad w=\frac{m_{31}-m_{13}}{4y},\ x=\frac{m_{12}+m_{21}}{4y},\ z=\frac{m_{23}+m_{32}}{4y}\\
z=\frac{\sqrt{-m_{11}-m_{22}+m_{33}+1}}{2}\quad\Rightarrow\quad w=\frac{m_{12}-m_{21}}{4z},\ x=\frac{m_{31}+m_{13}}{4z},\ y=\frac{m_{23}+m_{32}}{4z}
\end{aligned}
$$
é€‰æ‹©å…¶ä¸­ä»»æ„ä¸€è¡Œï¼Œå…¶ä»–çš„çš„ä¸‰ä¸ªåˆ†é‡éƒ½ä¼šå—ç¬¬ä¸€ä¸ªåˆ†é‡å½±å“ï¼Œäº§ç”Ÿæ•°å€¼ä¸ç¨³å®šã€‚
Shoemake å»ºè®®é¦–å…ˆç¡®å®šÂ Â ğ‘¤ã€Â Â ğ‘¥ã€Â Â ğ‘¦å’ŒÂ Â ğ‘§ä¸­å“ªä¸€ä¸ªå…·æœ‰æœ€å¤§ç»å¯¹å€¼çš„ç­–ç•¥ï¼ˆæˆ‘ä»¬å¯ä»¥åœ¨ä¸æ‰§è¡Œä»»ä½•å¹³æ–¹æ ¹çš„æƒ…å†µä¸‹å®Œæˆï¼‰ï¼Œä½¿ç”¨çŸ©é˜µçš„å¯¹è§’çº¿è®¡ç®—è¯¥åˆ†é‡ï¼Œç„¶åé€‰æ‹©è®¡ç®—å…¬å¼ã€‚

> è‚¯Â·èˆ’æ¢…å…‹ã€‚ â€œæ¬§æ‹‰è§’è½¬æ¢ã€‚â€ ã€ŠGraphics Gems IVã€‹ï¼ŒPaul S. Heckbert ç¼–è¾‘ã€‚åœ£åœ°äºšå“¥ï¼šå­¦æœ¯å‡ºç‰ˆç¤¾ä¸“ä¸šäººå£«ï¼Œ1994 å¹´ã€‚


## å°†æ¬§æ‹‰è§’è½¬æ¢ä¸ºå››å…ƒæ•° Euler Angles to a Quaternion
å°†æ¬§æ‹‰è§’åˆ†é…ç»™å˜é‡Â Â hã€Â Â p å’ŒÂ Â bã€‚ä»¤Â Â hã€Â Â p å’ŒÂ Â b ä¸ºå››å…ƒæ•°ï¼Œå®ƒä»¬æ‰§è¡Œå›´ç»•Â Â ğ‘¦ã€Â Â ğ‘¥å’ŒÂ Â ğ‘§- è½´åˆ†åˆ«ä¸º:
$$
\begin{aligned}
h=\left[\begin{array}{c}
\cos (h / 2) \\
0 \\
\sin (h / 2) \\
0
\end{array}\right], \quad p=\left[\begin{array}{c}
\cos (p / 2) \\
\sin (p / 2) \\
0 \\
0
\end{array}\right], \quad b=\left[\begin{array}{c}
\cos (b / 2) \\
0 \\
0 \\
\sin (b / 2)
\end{array}\right] .
\end{aligned}
$$

$$
\begin{align}
\mathrm{q}_{object \rightarrow upright}(\mathrm{h}, \mathrm{p}, \mathrm{b}) &= \mathrm{hpb} \\
&= 
\left[\begin{array}{c}
\cos (h / 2) \cos (p / 2) \cos (b / 2)+\sin (h / 2) \sin (p / 2) \sin (b / 2) \\
\left (
\begin{matrix}
\cos (h / 2) \sin (p / 2) \cos (b / 2)+\sin (h / 2) \cos (p / 2) \sin (b / 2) \\
\sin (h / 2) \cos (p / 2) \cos (b / 2)-\cos (h / 2) \sin (p / 2) \sin (b / 2)\\
\cos (h / 2) \cos (p / 2) \sin (b / 2)-\sin (h / 2) \sin (p / 2) \cos (b / 2)
\end{matrix}
\right)
\end{array}\right]
\end{align}
$$
ä»ç›´ç«‹ç©ºé—´åˆ°å¯¹è±¡ç©ºé—´çš„å››å…ƒæ•°å°±æ˜¯å…±è½­ï¼š
$$
\begin{align}
\mathrm{q}_{upright \rightarrow object}(\mathrm{h}, \mathrm{p}, \mathrm{b}) &= \mathrm{q}_{object \rightarrow upright}(\mathrm{h}, \mathrm{p}, \mathrm{b})^* \\
&= 
\left[\begin{array}{c}

\cos (h / 2) \cos (p / 2) \cos (b / 2)+\sin (h / 2) \sin (p / 2) \sin (b / 2) \\
\left(\begin{array}{c}
-\cos (h / 2) \sin (p / 2) \cos (b / 2)-\sin (h / 2) \cos (p / 2) \sin (b / 2) \\
\cos (h / 2) \sin (p / 2) \sin (b / 2)-\sin (h / 2) \cos (p / 2) \cos (b / 2) \\
\sin (h / 2) \sin (p / 2) \cos (b / 2)-\cos (h / 2) \cos (p / 2) \sin (b / 2)
\end{array}\right)
\end{array}\right]
\end{align}
$$

## å°†å››å…ƒæ•°è½¬æ¢ä¸ºæ¬§æ‹‰è§’  Quaternion to Euler Angles
æ ¹æ®çŸ©é˜µè½¬è½¬æ¬§æ‹‰è§’çš„è§£
$$
\begin{aligned}
p & =\arcsin \left(-m_{32}\right) \\
h & =\left\{\begin{array}{ll}
\operatorname{atan2}\left(m_{31}, m_{33}\right) & \text { if } \cos p \neq 0, \\
\operatorname{atan2}\left(-m_{13}, m_{11}\right) & \text { otherwise. }
\end{array}\right. \\
b & =\left\{\begin{array}{ll}
\operatorname{atan2}\left(m_{12}, m_{22}\right) & \text { if } \cos p \neq 0, \\
0 & \text { otherwise. }
\end{array}\right.
\end{aligned}
$$
ä»¥åŠå››å…ƒæ•°è½¬çŸ©é˜µæ±‚è§£
$$
\left[\begin{array}{ccc}
1-2 y^{2}-2 z^{2} & 2 x y+2 w z & 2 x z-2 w y \\
2 x y-2 w z & 1-2 x^{2}-2 z^{2} & 2 y z+2 w x \\
2 x z+2 w y & 2 y z-2 w x & 1-2 x^{2}-2 y^{2}
\end{array}\right] .
$$
å°†åè€…å¸¦å…¥å‰è€…å¹¶åŒ–ç®€å¾—åˆ°ï¼Œå®ƒå°†å¯¹è±¡åˆ°ç›´ç«‹å››å…ƒæ•°è½¬æ¢ä¸ºæ¬§æ‹‰è§’ã€‚
$$
\begin{aligned}
p & =\arcsin \left(-m_{32}\right) \\
& =\arcsin \left(-2(y z-w x)\right) \\
h & =\left\{\begin{array}{l}
\operatorname{atan2}\left(m_{31}, m_{33}\right) \\
=\operatorname{atan2}\left(2 x z+2 w y, 1-2 x^{2}-2 y^{2}\right) \quad &\text { if } \cos p \neq 0, \\
=\operatorname{atan2}\left(x z+w y, 1 / 2-x^{2}-y^{2}\right) \\
\operatorname{atan2}\left(-m_{13}, m_{11}\right) \\
=\operatorname{atan2}\left(-2 x z+2 w y, 1-2 y^{2}-2 z^{2}\right) &\text { otherwise. } \\
=\operatorname{atan2}\left(-x z+w y, 1 / 2-y^{2}-z^{2}\right)
\end{array}\right. \\
b & =\left\{\begin{array}{l}
\operatorname{atan2}\left(m_{12}, m_{22}\right) \\
=\operatorname{atan2}\left(2 x y+2 w z, 1-2 x^{2}-2 z^{2}\right) &\text { if } \cos p \neq 0, \\
=\operatorname{atan2}\left(x y+w z, 1 / 2-x^{2}-z^{2}\right) \\
0 \quad &\text { otherwise. }
\end{array}\right.
\end{aligned}
$$
è¦å°†ç›´ç«‹åˆ°å¯¹è±¡å››å…ƒæ•°è½¬æ¢æˆæ¬§æ‹‰è§’æ ¼å¼ï¼Œä½¿ç”¨å‡ ä¹ç›¸åŒçš„æ–¹å¼ï¼Œæ˜¯éœ€è¦å°† xã€y å’Œ z å€¼å–åã€‚